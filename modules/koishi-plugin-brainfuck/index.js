var u=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var k=(i,t)=>()=>(i&&(t=i(i=0)),t);var g=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var p=(i,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of b(t))!w.call(i,s)&&s!==e&&u(i,s,{get:()=>t[s],enumerable:!(a=l(t,s))||a.enumerable});return i},m=(i,t,e)=>(p(i,t,"default"),e&&p(e,t,"default"));var x=i=>p(u({},"__esModule",{value:!0}),i);var o={};import*as z from"https://registry.koishi.chat/modules/koishi/index.js";var f=k(()=>{m(o,z)});var y=g(r=>{Object.defineProperty(r,"__esModule",{value:!0});r.apply=r.name=r.Config=void 0;var h=(f(),x(o));r.Config=h.Schema.object({cellSize:h.Schema.natural().default(8).description("每个单元占用的比特数。"),memorySize:h.Schema.natural().default(1024).description("允许的最大单元数目。"),maxSteps:h.Schema.natural().default(16384).description("允许的最大步数。")});var n=class extends Error{},d=class{constructor(t,e){this.source=t,this.options=e,this.data=[0],this.pointer=0,this.map={},this.mask=(1<<this.options.cellSize)-1}exec(t=""){let e="",a=0,s=0;for(;a<this.source.length;){switch(this.source.charCodeAt(a)){case 43:this.data[this.pointer]=++this.data[this.pointer]&this.mask;break;case 45:this.data[this.pointer]=--this.data[this.pointer]&this.mask;break;case 62:if(++this.pointer>=this.options.memorySize)throw new n("max memory exceed");this.data[this.pointer]===void 0&&(this.data[this.pointer]=0);break;case 60:if(!this.pointer)throw new n("negative pointer");--this.pointer;break;case 46:e+=String.fromCharCode(this.data[this.pointer]);break;case 44:this.data[this.pointer]=t.charCodeAt(0),t=t.slice(1);break;case 91:{let c=this.findMatch(a);this.data[this.pointer]||(a=c);break}case 93:if(this.map[a]===void 0)throw new n(`no matching "[" at position ${a}`);this.data[this.pointer]&&(a=this.map[a])}if(++a,++s===this.options.maxSteps)throw new n("max step exceeded")}return e}findMatch(t){let e=this.map[t];if(e)return e;for(e=t+1;e<this.source.length&&this.source.charCodeAt(e)!==93;)this.source.charCodeAt(e)===91&&(e=this.findMatch(e)),++e;if(e===this.source.length)throw new n(`no matching "]" at position ${t}`);return this.map[e]=t,this.map[t]=e}};r.name="brainfuck";function S(i,t){i.command("brainfuck <code>","运行 brainfuck 代码").alias("bf").option("input","-- <input:rawtext>  设置输入",{fallback:""}).usage("语言介绍：http://www.muppetlabs.com/~breadbox/bf").action(async({options:e},a)=>{if(!a)return"请输入源代码。";a=h.segment.unescape(a);let s=e.input;try{return h.segment.escape(new d(a,t).exec(s))}catch(c){if(c.name==="BFError")return c.message}})}r.apply=S});export default y();
