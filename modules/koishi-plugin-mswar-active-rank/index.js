var ce=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var Ie=(e,t)=>()=>(e&&(t=e(e=0)),t);var X=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Q=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let p of Ne(t))!Re.call(e,p)&&p!==n&&ce(e,p,{get:()=>t[p],enumerable:!(a=Me(t,p))||a.enumerable});return e},T=(e,t,n)=>(Q(e,t,"default"),n&&Q(n,t,"default"));var Ee=e=>Q(ce({},"__esModule",{value:!0}),e);var Oe=X((et,ke)=>{"use strict";var Y=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyNames,We=Object.prototype.hasOwnProperty,f=(e,t)=>Y(e,"name",{value:t,configurable:!0}),Je=(e,t)=>{for(var n in t)Y(e,n,{get:t[n],enumerable:!0})},Ye=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let p of Ue(t))!We.call(e,p)&&p!==n&&Y(e,p,{get:()=>t[p],enumerable:!(a=Le(t,p))||a.enumerable});return e},qe=e=>Ye(Y({},"__esModule",{value:!0}),e),ue={};Je(ue,{Time:()=>ee,arrayBufferToBase64:()=>we,base64ToArrayBuffer:()=>Ae,camelCase:()=>re,camelize:()=>Ge,capitalize:()=>ze,clone:()=>W,contain:()=>ge,deduplicate:()=>ve,deepEqual:()=>J,defineProperty:()=>ye,difference:()=>be,hyphenate:()=>Ke,intersection:()=>me,is:()=>U,isNullable:()=>E,isPlainObject:()=>pe,makeArray:()=>je,noop:()=>fe,omit:()=>he,paramCase:()=>ne,pick:()=>de,remove:()=>_e,sanitize:()=>Se,snakeCase:()=>Ce,trimSlash:()=>ae,uncapitalize:()=>q,union:()=>xe,valueMap:()=>te});ke.exports=qe(ue);function fe(){}f(fe,"noop");function E(e){return e==null}f(E,"isNullable");function pe(e){return e&&typeof e=="object"&&!Array.isArray(e)}f(pe,"isPlainObject");function te(e,t){return Object.fromEntries(Object.entries(e).map(([n,a])=>[n,t(a,n)]))}f(te,"valueMap");function U(e,t){return e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}f(U,"is");function W(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(W):U("Date",e)?new Date(e.valueOf()):U("RegExp",e)?new RegExp(e.source,e.flags):te(e,W)}f(W,"clone");function J(e,t,n){return e===t||!n&&E(e)&&E(t)?!0:typeof e!=typeof t||typeof e!="object"||!e||!t?!1:Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every((a,p)=>J(a,t[p])):Array.isArray(t)?!1:Object.keys({...e,...t}).every(a=>J(e[a],t[a]))}f(J,"deepEqual");function de(e,t,n){if(!t)return{...e};let a={};for(let p of t)(n||p in e)&&(a[p]=e[p]);return a}f(de,"pick");function he(e,t){if(!t)return{...e};let n={...e};for(let a of t)Reflect.deleteProperty(n,a);return n}f(he,"omit");function ye(e,t,n){return Object.defineProperty(e,t,{writable:!0,value:n})}f(ye,"defineProperty");function ge(e,t){return t.every(n=>e.includes(n))}f(ge,"contain");function me(e,t){return e.filter(n=>t.includes(n))}f(me,"intersection");function be(e,t){return e.filter(n=>!t.includes(n))}f(be,"difference");function xe(e,t){return Array.from(new Set([...e,...t]))}f(xe,"union");function ve(e){return[...new Set(e)]}f(ve,"deduplicate");function _e(e,t){let n=e.indexOf(t);return n>=0?(e.splice(n,1),!0):!1}f(_e,"remove");function je(e){return Array.isArray(e)?e:E(e)?[]:[e]}f(je,"makeArray");function we(e){if(typeof Buffer<"u")return Buffer.from(e).toString("base64");let t="",n=new Uint8Array(e);for(let a=0;a<n.byteLength;a++)t+=String.fromCharCode(n[a]);return btoa(t)}f(we,"arrayBufferToBase64");function Ae(e){if(typeof Buffer<"u")return Buffer.from(e,"base64").buffer;let t=atob(e.replace(/\s/g,"")),n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}f(Ae,"base64ToArrayBuffer");function ze(e){return e.charAt(0).toUpperCase()+e.slice(1)}f(ze,"capitalize");function q(e){return e.charAt(0).toLowerCase()+e.slice(1)}f(q,"uncapitalize");function re(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}f(re,"camelCase");function ne(e){return q(e).replace(/_/g,"-").replace(/.[A-Z]+/g,t=>t[0]+"-"+t.slice(1).toLowerCase())}f(ne,"paramCase");function Ce(e){return q(e).replace(/-/g,"_").replace(/.[A-Z]+/g,t=>t[0]+"_"+t.slice(1).toLowerCase())}f(Ce,"snakeCase");var Ge=re,Ke=ne;function ae(e){return e.replace(/\/$/,"")}f(ae,"trimSlash");function Se(e){return e.startsWith("/")||(e="/"+e),ae(e)}f(Se,"sanitize");var ee;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function n(i){t=i}e.setTimezoneOffset=n,f(n,"setTimezoneOffset");function a(){return t}e.getTimezoneOffset=a,f(a,"getTimezoneOffset");function p(i=new Date,c){return typeof i=="number"&&(i=new Date(i)),c===void 0&&(c=t),Math.floor((i.valueOf()/e.minute-c)/1440)}e.getDateNumber=p,f(p,"getDateNumber");function j(i,c){let P=new Date(i*e.day);return c===void 0&&(c=t),new Date(+P+c*e.minute)}e.fromDateNumber=j,f(j,"fromDateNumber");let k=/\d+(?:\.\d+)?/.source,w=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(i=>`(${k}${i})?`).join("")}$`);function A(i){let c=w.exec(i);return c?(parseFloat(c[1])*e.week||0)+(parseFloat(c[2])*e.day||0)+(parseFloat(c[3])*e.hour||0)+(parseFloat(c[4])*e.minute||0)+(parseFloat(c[5])*e.second||0):0}e.parseTime=A,f(A,"parseTime");function $(i){let c=A(i);return c?i=Date.now()+c:/^\d{1,2}(:\d{1,2}){1,2}$/.test(i)?i=`${new Date().toLocaleDateString()}-${i}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(i)&&(i=`${new Date().getFullYear()}-${i}`),i?new Date(i):new Date}e.parseDate=$,f($,"parseDate");function y(i){let c=Math.abs(i);return c>=e.day-e.hour/2?Math.round(i/e.day)+"d":c>=e.hour-e.minute/2?Math.round(i/e.hour)+"h":c>=e.minute-e.second/2?Math.round(i/e.minute)+"m":c>=e.second?Math.round(i/e.second)+"s":i+"ms"}e.format=y,f(y,"format");function v(i,c=2){return i.toString().padStart(c,"0")}e.toDigits=v,f(v,"toDigits");function B(i,c=new Date){return i.replace("yyyy",c.getFullYear().toString()).replace("yy",c.getFullYear().toString().slice(2)).replace("MM",v(c.getMonth()+1)).replace("dd",v(c.getDate())).replace("hh",v(c.getHours())).replace("mm",v(c.getMinutes())).replace("ss",v(c.getSeconds())).replace("SSS",v(c.getMilliseconds(),3))}e.template=B,f(B,"template")})(ee||(ee={}))});var Pe=X((tt,$e)=>{var Ze=Object.defineProperty,b=(e,t)=>Ze(e,"name",{value:t,configurable:!0}),_=Oe(),De=Symbol.for("satori.element");function K(e){return e&&typeof e=="object"&&e[De]}b(K,"isElement");function ie(e){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){if(e=""+e,e)return F("text",{content:e})}else{if(K(e))return e;if(!(0,_.isNullable)(e))throw new TypeError(`Invalid content: ${e}`)}}b(ie,"toElement");function G(e){return Array.isArray(e)?e.map(ie).filter(t=>t):[ie(e)].filter(t=>t)}b(G,"toElementArray");var Z=class{get data(){return this.attrs}toString(e=!1){if(this.type==="text")return e?this.attrs.content:F.escape(this.attrs.content);let t=this.children.map(a=>a.toString(e)).join("");if(e)return t;let n=Object.entries(this.attrs).map(([a,p])=>(0,_.isNullable)(p)?"":(a=(0,_.hyphenate)(a),p===!0?` ${a}`:p===!1?` no-${a}`:` ${a}="${F.escape(""+p,!0)}"`)).join("");return this.children.length?`<${this.type}${n}>${t}</${this.type}>`:`<${this.type}${n}/>`}};b(Z,"ElementConstructor");(0,_.defineProperty)(Z,"name","Element");(0,_.defineProperty)(Z.prototype,De,!0);function F(e,...t){let n=Object.create(Z.prototype),a={},p=[];if(t[0]&&typeof t[0]=="object"&&!K(t[0])&&!Array.isArray(t[0])){let j=t.shift();for(let[k,w]of Object.entries(j))(0,_.isNullable)(w)||(k==="children"?t.push(...(0,_.makeArray)(w)):a[k]=w)}for(let j of t)p.push(...G(j));return Object.assign(n,{type:e,attrs:a,children:p})}b(F,"Element");var He=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(e=>{e.jsx=e,e.jsxs=e,e.jsxDEV=e,e.Fragment="template";function t(s,r){return typeof s!="string"?G(s):e.parse(s,r)}e.normalize=t,b(t,"normalize");function n(s,r=!1){let o=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return r?o.replace(/"/g,"&quot;"):o}e.escape=n,b(n,"escape");function a(s){return s.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(r,o)=>o==="38"?r:String.fromCharCode(+o)).replace(/&#x([0-9a-f]+);/gi,(r,o)=>o==="26"?r:String.fromCharCode(parseInt(o,16))).replace(/&(amp|#38|#x26);/g,"&")}e.unescape=a,b(a,"unescape");function p(s,r={}){var o;let u=i(s);return r.caret?r.type&&((o=u[0])==null?void 0:o.type)!==r.type?void 0:u[0]:w(u,r.type||"*")[0]}e.from=p,b(p,"from");let j=/ *([ >+~]) */g;function k(s){return s.split(",").map(r=>{let o=[];r=r.trim();let u,x=" ";for(;u=j.exec(r);)o.push({type:r.slice(0,u.index),combinator:x}),x=u[1],r=r.slice(u.index+u[0].length);return o.push({type:r,combinator:x}),o})}e.parseSelector=k,b(k,"parseSelector");function w(s,r){if(typeof s=="string"&&(s=i(s)),typeof r=="string"&&(r=k(r)),!r.length)return;let o=[],u=[];for(let[x,z]of s.entries()){let C=[],m=[...r,...o];o=[];let O=!1;for(let l of m){let{type:d,combinator:g}=l[0];(d===z.type||d==="*")&&(l.length===1?O=!0:[" ",">"].includes(l[1].combinator)?C.push(l.slice(1)):l[1].combinator==="+"?o.push(l.slice(1)):r.push(l.slice(1))),g===" "&&C.push(l)}O&&u.push(s[x]),u.push(...w(z.children,C))}return u}e.select=w,b(w,"select");function A(s,r){var o;if(s=s.trim(),!/^[\w.]+$/.test(s))return(o=He(s,r))!=null?o:"";let u=r;for(let x of s.split("."))if(u=u[x],(0,_.isNullable)(u))return"";return u??""}e.interpolate=A,b(A,"interpolate");let $=/<!--[\s\S]*?-->|<(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>/,y=/([^\s=]+)(?:="([^"]*)"|='([^']*)')?/g,v=/([^\s=]+)(?:="([^"]*)"|='([^']*)'|=\{([^}]+)\})?/g,B=/\{([^}]*)\}/;function i(s,r){let o=[];function u(l){l&&o.push(e("text",{content:l}))}b(u,"pushText");let x=r?v:y,z;for(;z=$.exec(s);){C(s.slice(0,z.index));let[l,d,g,H,V]=z;if(s=s.slice(z.index+l.length),l.startsWith("<!"))continue;let R={source:l,type:g||e.Fragment,close:d,empty:V,attrs:{}},se;for(;se=x.exec(H);){let[Xe,I,Fe,oe=Fe,le]=se;le?R.attrs[(0,_.camelize)(I)]=A(le,r):(0,_.isNullable)(oe)?I.startsWith("no-")?R.attrs[(0,_.camelize)(I.slice(3))]=!1:R.attrs[(0,_.camelize)(I)]=!0:R.attrs[(0,_.camelize)(I)]=a(oe)}o.push(R)}C(s);function C(l){if(l=l.replace(/^\s*\n\s*/,"").replace(/\s*\n\s*$/,""),r){let d;for(;d=B.exec(l);){let[g,H]=d;u(a(l.slice(0,d.index))),l=l.slice(d.index+g.length);let V=A(H,r);o.push(...G(V))}}u(a(l))}b(C,"parseContent");let m=[e(e.Fragment)];function O(l){for(;l>0;l--){let{children:d}=m.shift(),{source:g}=m[0].children.pop();m[0].children.push(e("text",{content:g})),m[0].children.push(...d)}}b(O,"rollback");for(let l of o)if(K(l))m[0].children.push(l);else if(l.close){let d=0;for(;d<m.length&&m[d].type!==l.type;)d++;if(d===m.length)m[0].children.push(e("text",{content:l.source}));else{O(d);let g=m.shift();delete g.source}}else{let d=e(l.type,l.attrs);m[0].children.push(d),l.empty||(d.source=l.source,m.unshift(d))}return O(m.length-1),m[0].children}e.parse=i,b(i,"parse");function c(s,r,o){let u=typeof s=="string"?i(s):s,x=[];return u.forEach(z=>{var C,m;let{type:O,attrs:l,children:d}=z,g=(m=(C=r[O])!=null?C:r.default)!=null?m:!0;typeof g=="function"&&(g=g(l,d,o)),g===!0?x.push(e(O,l,c(d,r,o))):g!==!1&&x.push(...t(g))}),typeof s=="string"?x.join(""):x}e.transform=c,b(c,"transform");async function P(s,r,o){let u=typeof s=="string"?i(s):s,x=(await Promise.all(u.map(async z=>{var C,m;let{type:O,attrs:l,children:d}=z,g=(m=(C=r[O])!=null?C:r.default)!=null?m:!0;return typeof g=="function"&&(g=await g(l,d,o)),g===!0?[e(O,l,await P(d,r,o))]:g!==!1?t(g):[]}))).flat(1);return typeof s=="string"?x.join(""):x}e.transformAsync=P,b(P,"transformAsync");function M(s,...r){return(...o)=>{let u=e(s);return r.forEach((x,z)=>{(0,_.isNullable)(o[z])||(u.attrs[x]=o[z])}),o[r.length]&&Object.assign(u.attrs,o[r.length]),u}}b(M,"createFactory"),e.warn=b(()=>{},"warn");function N(s){return(r,...o)=>{let u="base64://";return typeof o[0]=="string"&&(u=`data:${o.shift()};base64,`),(0,_.is)("Buffer",r)?r=u+r.toString("base64"):(0,_.is)("ArrayBuffer",r)&&(r=u+(0,_.arrayBufferToBase64)(r)),r.startsWith("base64://")&&(0,e.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),e(s,{...o[0],url:r})}}b(N,"createAssetFactory"),e.text=M("text","content"),e.at=M("at","id"),e.sharp=M("sharp","id"),e.quote=M("quote","id"),e.image=N("image"),e.video=N("video"),e.audio=N("audio"),e.file=N("file")})(F||(F={}));$e.exports=F});var L={};import*as nt from"https://registry.koishi.chat/modules/koishi/index.js";var Be=Ie(()=>{T(L,nt)});var Qe=X(S=>{Object.defineProperty(S,"__esModule",{value:!0});S.apply=S.Config=S.Rule=S.usage=S.name=void 0;var h=Pe(),D=(Be(),Ee(L));S.name="mswar-active-rank";S.usage=`
## 注意事项
> 建议使用前玩一局[扫雷联萌](http://tapsss.com)
作者服务器经常掉线，支持<a href=https://github.com/initialencounter/mykoishi/smear_rank">自建服务器</a>
本插件只用于体现 Koishi 部署者意志”。
对于部署者行为及所产生的任何纠纷， Koishi 及 koishi-plugin-mswar-active-rank 概不负责。
如果有更多文本内容想要修改，可以在<a href="/locales">本地化</a>中修改 zh 内容
`;S.Rule=D.Schema.object({platform:D.Schema.string().description("平台名称。").required(),channelId:D.Schema.string().description("频道 ID。").required(),guildId:D.Schema.string().description("群组 ID。"),selfId:D.Schema.string().description("机器人 ID。")});S.Config=D.Schema.object({api_hostname:D.Schema.string().description("自建服务器地址").default("http://116.205.167.54:5140"),rules:D.Schema.array(S.Rule).description("推送规则。"),interval:D.Schema.number().default(D.Time.minute*30).description("轮询间隔 (毫秒)。"),background_img:D.Schema.string().default("https://img0.baidu.com/it/u=2013803511,2814800709&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500").description("背景图片url,http开头:"),border:D.Schema.string().default("&").description("边界")});function Ve(e,t){let n=`${t.api_hostname}/get`;var a=t.background_img;new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i").test(t.background_img)||(a="https://img0.baidu.com/it/u=2013803511,2814800709&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500"),e.command("扫雷活跃榜").alias("ms-ac").action(async()=>{let j=await e.http.get(n),k=j.mine_rank.今日.高级,w=j.puzzle_rank.今日["4x4"],A=[(0,h.jsx)("div",{children:"扫雷联萌tapsss.com"}),(0,h.jsx)("div",{children:"扫雷高级日榜"}),(0,h.jsx)("br",{})];k.forEach((y,v)=>{A.push((0,h.jsxs)("div",{children:[y[0],". ",y[1]," ",y[3]]}))});let $=[(0,h.jsx)("div",{children:j.update_time}),(0,h.jsx)("div",{children:"15p日榜"}),(0,h.jsx)("br",{})];return w.forEach((y,v)=>{$.push((0,h.jsxs)("div",{children:["|",t.border,"|",y[0],". ",y[1]," ",y[3]]}))}),(0,h.jsxs)("html",{children:[(0,h.jsx)("img",{src:a,style:"width:400px;height:550px"}),(0,h.jsx)("div",{style:"position: absolute;top:20px;left:20px;width:200px;",children:A}),(0,h.jsx)("div",{style:"position: absolute;top:20px;left:220px;width:200px;",children:$})]})}),e.on("ready",async()=>{e.setInterval(async()=>{let j=await e.http.get(n),k=j.mine_rank.今日.高级,w=j.puzzle_rank.今日["4x4"],A=[(0,h.jsx)("div",{children:"扫雷联萌tapsss.com"}),(0,h.jsx)("div",{children:"扫雷高级日榜"}),(0,h.jsx)("br",{})];k.forEach((y,v)=>{A.push((0,h.jsxs)("div",{children:[y[0],". ",y[1]," ",y[3]]}))});let $=[(0,h.jsxs)("div",{children:["|",t.border,"|",j.update_time]}),(0,h.jsxs)("div",{children:["|",t.border,"|15p日榜"]}),(0,h.jsx)("br",{})];w.forEach((y,v)=>{$.push((0,h.jsxs)("div",{children:["|",t.border,"|",y[0],". ",y[1]," ",y[3]]}))});for(let{channelId:y,platform:v,selfId:B,guildId:i}of t.rules){if(!B){let P=await e.database.getChannel(v,y,["assignee","guildId"]);if(!P||!P.assignee)return;B=P.assignee,i=P.guildId}e.bots[`${v}:${B}`]?.sendMessage(y,(0,h.jsxs)("html",{children:[(0,h.jsx)("img",{src:a,style:"width:400px;height:550px"}),(0,h.jsx)("div",{style:"position: absolute;top:20px;left:20px;width:200px;",children:A}),(0,h.jsx)("div",{style:"position: absolute;top:20px;left:220px;width:200px;",children:$})]}),i)}},t.interval)})}S.apply=Ve});export default Qe();
