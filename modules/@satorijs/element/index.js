import{arrayBufferToBase64 as et,camelize as B,defineProperty as K,hyphenate as rt,is as L,isNullable as _,makeArray as nt}from"https://registry.koishi.chat/modules/cosmokit/index.js";var q=Object.defineProperty,E=Object.getOwnPropertyNames,c=($,x)=>q($,"name",{value:x,configurable:!0}),tt=($,x)=>function(){return x||(0,$[E($)[0]])((x={exports:{}}).exports,x),x.exports},st=tt({"satori/packages/element/src/index.ts"($,x){var T=Symbol.for("satori.element");function P(t){return t&&typeof t=="object"&&t[T]}c(P,"isElement");function N(t){if(typeof t=="string"||typeof t=="number"||typeof t=="boolean"){if(t=""+t,t)return b("text",{content:t})}else{if(P(t))return t;if(!_(t))throw new TypeError(`Invalid content: ${t}`)}}c(N,"toElement");function R(t){return Array.isArray(t)?t.map(N).filter(f=>f):[N(t)].filter(f=>f)}c(R,"toElementArray");var k=class{get data(){return this.attrs}toString(t=!1){if(this.type==="text")return t?this.attrs.content:b.escape(this.attrs.content);let f=this.children.map(l=>l.toString(t)).join("");if(t)return f;let w=Object.entries(this.attrs).map(([l,d])=>_(d)?"":(l=rt(l),d===!0?` ${l}`:d===!1?` no-${l}`:` ${l}="${b.escape(""+d,!0)}"`)).join("");return this.children.length?`<${this.type}${w}>${f}</${this.type}>`:`<${this.type}${w}/>`}};c(k,"ElementConstructor"),K(k,"name","Element"),K(k.prototype,T,!0);function b(t,...f){let w=Object.create(k.prototype),l={},d=[];if(f[0]&&typeof f[0]=="object"&&!P(f[0])&&!Array.isArray(f[0])){let A=f.shift();for(let[j,m]of Object.entries(A))_(m)||(j==="children"?f.push(...nt(m)):l[j]=m)}for(let A of f)d.push(...R(A));return Object.assign(w,{type:t,attrs:l,children:d})}c(b,"Element");var M=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(t=>{t.jsx=t,t.jsxs=t,t.jsxDEV=t,t.Fragment="template";function f(s,e){return typeof s!="string"?R(s):t.parse(s,e)}t.normalize=f,c(f,"normalize");function w(s,e=!1){let n=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e?n.replace(/"/g,"&quot;"):n}t.escape=w,c(w,"escape");function l(s){return s.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(e,n)=>n==="38"?e:String.fromCharCode(+n)).replace(/&#x([0-9a-f]+);/gi,(e,n)=>n==="26"?e:String.fromCharCode(parseInt(n,16))).replace(/&(amp|#38|#x26);/g,"&")}t.unescape=l,c(l,"unescape");function d(s,e={}){let n=v(s);return e.caret?e.type&&n[0]?.type!==e.type?void 0:n[0]:m(n,e.type||"*")[0]}t.from=d,c(d,"from");let A=/ *([ >+~]) */g;function j(s){return s.split(",").map(e=>{let n=[];e=e.trim();let i,p=" ";for(;i=A.exec(e);)n.push({type:e.slice(0,i.index),combinator:p}),p=i[1],e=e.slice(i.index+i[0].length);return n.push({type:e,combinator:p}),n})}t.parseSelector=j,c(j,"parseSelector");function m(s,e){if(typeof s=="string"&&(s=v(s)),typeof e=="string"&&(e=j(e)),!e.length)return;let n=[],i=[];for(let[p,u]of s.entries()){let h=[],a=[...e,...n];n=[];let g=!1;for(let r of a){let{type:o,combinator:y}=r[0];(o===u.type||o==="*")&&(r.length===1?g=!0:[" ",">"].includes(r[1].combinator)?h.push(r.slice(1)):r[1].combinator==="+"?n.push(r.slice(1)):e.push(r.slice(1))),y===" "&&h.push(r)}g&&i.push(s[p]),i.push(...m(u.children,h))}return i}t.select=m,c(m,"select");function z(s,e){if(s=s.trim(),!/^[\w.]+$/.test(s))return M(s,e)??"";let n=e;for(let i of s.split("."))if(n=n[i],_(n))return"";return n??""}t.interpolate=z,c(z,"interpolate");let Q=/<!--[\s\S]*?-->|<(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>/,U=/([^\s=]+)(?:="([^"]*)"|='([^']*)')?/g,X=/([^\s=]+)(?:="([^"]*)"|='([^']*)'|=\{([^}]+)\})?/g,Y=/\{([^}]*)\}/;function v(s,e){let n=[];function i(r){r&&n.push(t("text",{content:r}))}c(i,"pushText");let p=e?X:U,u;for(;u=Q.exec(s);){h(s.slice(0,u.index));let[r,o,y,D,J]=u;if(s=s.slice(u.index+r.length),r.startsWith("<!"))continue;let O={source:r,type:y||t.Fragment,close:o,empty:J,attrs:{}},V;for(;V=p.exec(D);){let[it,F,Z,G=Z,H]=V;H?O.attrs[B(F)]=z(H,e):_(G)?F.startsWith("no-")?O.attrs[B(F.slice(3))]=!1:O.attrs[B(F)]=!0:O.attrs[B(F)]=l(G)}n.push(O)}h(s);function h(r){if(r=r.replace(/^\s*\n\s*/,"").replace(/\s*\n\s*$/,""),e){let o;for(;o=Y.exec(r);){let[y,D]=o;i(l(r.slice(0,o.index))),r=r.slice(o.index+y.length);let J=z(D,e);n.push(...R(J))}}i(l(r))}c(h,"parseContent");let a=[t(t.Fragment)];function g(r){for(;r>0;r--){let{children:o}=a.shift(),{source:y}=a[0].children.pop();a[0].children.push(t("text",{content:y})),a[0].children.push(...o)}}c(g,"rollback");for(let r of n)if(P(r))a[0].children.push(r);else if(r.close){let o=0;for(;o<a.length&&a[o].type!==r.type;)o++;if(o===a.length)a[0].children.push(t("text",{content:r.source}));else{g(o);let y=a.shift();delete y.source}}else{let o=t(r.type,r.attrs);a[0].children.push(o),r.empty||(o.source=r.source,a.unshift(o))}return g(a.length-1),a[0].children}t.parse=v,c(v,"parse");function W(s,e,n){let i=typeof s=="string"?v(s):s,p=[];return i.forEach(u=>{let{type:h,attrs:a,children:g}=u,r=e[h]??e.default??!0;typeof r=="function"&&(r=r(a,g,n)),r===!0?p.push(t(h,a,W(g,e,n))):r!==!1&&p.push(...f(r))}),typeof s=="string"?p.join(""):p}t.transform=W,c(W,"transform");async function I(s,e,n){let i=typeof s=="string"?v(s):s,p=(await Promise.all(i.map(async u=>{let{type:h,attrs:a,children:g}=u,r=e[h]??e.default??!0;return typeof r=="function"&&(r=await r(a,g,n)),r===!0?[t(h,a,await I(g,e,n))]:r!==!1?f(r):[]}))).flat(1);return typeof s=="string"?p.join(""):p}t.transformAsync=I,c(I,"transformAsync");function C(s,...e){return(...n)=>{let i=t(s);return e.forEach((p,u)=>{_(n[u])||(i.attrs[p]=n[u])}),n[e.length]&&Object.assign(i.attrs,n[e.length]),i}}c(C,"createFactory"),t.warn=c(()=>{},"warn");function S(s){return(e,...n)=>{let i="base64://";return typeof n[0]=="string"&&(i=`data:${n.shift()};base64,`),L("Buffer",e)?e=i+e.toString("base64"):L("ArrayBuffer",e)&&(e=i+et(e)),e.startsWith("base64://")&&(0,t.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),t(s,{...n[0],url:e})}}c(S,"createAssetFactory"),t.text=C("text","content"),t.at=C("at","id"),t.sharp=C("sharp","id"),t.quote=C("quote","id"),t.image=S("image"),t.video=S("video"),t.audio=S("audio"),t.file=S("file")})(b||(b={})),x.exports=b}}),ot=st();export{ot as default};
