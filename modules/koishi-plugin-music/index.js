var ce=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var We=(e,t)=>()=>(e&&(t=e(e=0)),t);var L=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var X=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let p of Ee(t))!Re.call(e,p)&&p!==r&&ce(e,p,{get:()=>t[p],enumerable:!(i=qe(t,p))||i.enumerable});return e},T=(e,t,r)=>(X(e,t,"default"),r&&X(r,t,"default"));var Le=e=>X(ce({},"__esModule",{value:!0}),e);var ze=L((it,ke)=>{"use strict";var Y=Object.defineProperty,Qe=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyNames,Ie=Object.prototype.hasOwnProperty,f=(e,t)=>Y(e,"name",{value:t,configurable:!0}),Ye=(e,t)=>{for(var r in t)Y(e,r,{get:t[r],enumerable:!0})},Ke=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let p of Ue(t))!Ie.call(e,p)&&p!==r&&Y(e,p,{get:()=>t[p],enumerable:!(i=Qe(t,p))||i.enumerable});return e},Ve=e=>Ke(Y({},"__esModule",{value:!0}),e),le={};Ye(le,{Time:()=>ee,arrayBufferToBase64:()=>Ae,base64ToArrayBuffer:()=>Fe,camelCase:()=>re,camelize:()=>Ze,capitalize:()=>Ce,clone:()=>U,contain:()=>ye,deduplicate:()=>je,deepEqual:()=>I,defineProperty:()=>me,difference:()=>be,hyphenate:()=>Ge,intersection:()=>ge,is:()=>Q,isNullable:()=>R,isPlainObject:()=>pe,makeArray:()=>ve,noop:()=>fe,omit:()=>de,paramCase:()=>ne,pick:()=>he,remove:()=>we,sanitize:()=>De,snakeCase:()=>_e,trimSlash:()=>ie,uncapitalize:()=>K,union:()=>xe,valueMap:()=>te});ke.exports=Ve(le);function fe(){}f(fe,"noop");function R(e){return e==null}f(R,"isNullable");function pe(e){return e&&typeof e=="object"&&!Array.isArray(e)}f(pe,"isPlainObject");function te(e,t){return Object.fromEntries(Object.entries(e).map(([r,i])=>[r,t(i,r)]))}f(te,"valueMap");function Q(e,t){return e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}f(Q,"is");function U(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(U):Q("Date",e)?new Date(e.valueOf()):Q("RegExp",e)?new RegExp(e.source,e.flags):te(e,U)}f(U,"clone");function I(e,t,r){return e===t||!r&&R(e)&&R(t)?!0:typeof e!=typeof t||typeof e!="object"||!e||!t?!1:Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every((i,p)=>I(i,t[p])):Array.isArray(t)?!1:Object.keys({...e,...t}).every(i=>I(e[i],t[i]))}f(I,"deepEqual");function he(e,t,r){if(!t)return{...e};let i={};for(let p of t)(r||p in e)&&(i[p]=e[p]);return i}f(he,"pick");function de(e,t){if(!t)return{...e};let r={...e};for(let i of t)Reflect.deleteProperty(r,i);return r}f(de,"omit");function me(e,t,r){return Object.defineProperty(e,t,{writable:!0,value:r})}f(me,"defineProperty");function ye(e,t){return t.every(r=>e.includes(r))}f(ye,"contain");function ge(e,t){return e.filter(r=>t.includes(r))}f(ge,"intersection");function be(e,t){return e.filter(r=>!t.includes(r))}f(be,"difference");function xe(e,t){return Array.from(new Set([...e,...t]))}f(xe,"union");function je(e){return[...new Set(e)]}f(je,"deduplicate");function we(e,t){let r=e.indexOf(t);return r>=0?(e.splice(r,1),!0):!1}f(we,"remove");function ve(e){return Array.isArray(e)?e:R(e)?[]:[e]}f(ve,"makeArray");function Ae(e){if(typeof Buffer<"u")return Buffer.from(e).toString("base64");let t="",r=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)t+=String.fromCharCode(r[i]);return btoa(t)}f(Ae,"arrayBufferToBase64");function Fe(e){if(typeof Buffer<"u")return Buffer.from(e,"base64").buffer;let t=atob(e.replace(/\s/g,"")),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}f(Fe,"base64ToArrayBuffer");function Ce(e){return e.charAt(0).toUpperCase()+e.slice(1)}f(Ce,"capitalize");function K(e){return e.charAt(0).toLowerCase()+e.slice(1)}f(K,"uncapitalize");function re(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}f(re,"camelCase");function ne(e){return K(e).replace(/_/g,"-").replace(/.[A-Z]+/g,t=>t[0]+"-"+t.slice(1).toLowerCase())}f(ne,"paramCase");function _e(e){return K(e).replace(/-/g,"_").replace(/.[A-Z]+/g,t=>t[0]+"_"+t.slice(1).toLowerCase())}f(_e,"snakeCase");var Ze=re,Ge=ne;function ie(e){return e.replace(/\/$/,"")}f(ie,"trimSlash");function De(e){return e.startsWith("/")||(e="/"+e),ie(e)}f(De,"sanitize");var ee;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function r(a){t=a}e.setTimezoneOffset=r,f(r,"setTimezoneOffset");function i(){return t}e.getTimezoneOffset=i,f(i,"getTimezoneOffset");function p(a=new Date,c){return typeof a=="number"&&(a=new Date(a)),c===void 0&&(c=t),Math.floor((a.valueOf()/e.minute-c)/1440)}e.getDateNumber=p,f(p,"getDateNumber");function z(a,c){let k=new Date(a*e.day);return c===void 0&&(c=t),new Date(+k+c*e.minute)}e.fromDateNumber=z,f(z,"fromDateNumber");let A=/\d+(?:\.\d+)?/.source,m=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(a=>`(${A}${a})?`).join("")}$`);function v(a){let c=m.exec(a);return c?(parseFloat(c[1])*e.week||0)+(parseFloat(c[2])*e.day||0)+(parseFloat(c[3])*e.hour||0)+(parseFloat(c[4])*e.minute||0)+(parseFloat(c[5])*e.second||0):0}e.parseTime=v,f(v,"parseTime");function S(a){let c=v(a);return c?a=Date.now()+c:/^\d{1,2}(:\d{1,2}){1,2}$/.test(a)?a=`${new Date().toLocaleDateString()}-${a}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(a)&&(a=`${new Date().getFullYear()}-${a}`),a?new Date(a):new Date}e.parseDate=S,f(S,"parseDate");function j(a){let c=Math.abs(a);return c>=e.day-e.hour/2?Math.round(a/e.day)+"d":c>=e.hour-e.minute/2?Math.round(a/e.hour)+"h":c>=e.minute-e.second/2?Math.round(a/e.minute)+"m":c>=e.second?Math.round(a/e.second)+"s":a+"ms"}e.format=j,f(j,"format");function _(a,c=2){return a.toString().padStart(c,"0")}e.toDigits=_,f(_,"toDigits");function P(a,c=new Date){return a.replace("yyyy",c.getFullYear().toString()).replace("yy",c.getFullYear().toString().slice(2)).replace("MM",_(c.getMonth()+1)).replace("dd",_(c.getDate())).replace("hh",_(c.getHours())).replace("mm",_(c.getMinutes())).replace("ss",_(c.getSeconds())).replace("SSS",_(c.getMilliseconds(),3))}e.template=P,f(P,"template")})(ee||(ee={}))});var $e=L((at,Se)=>{var He=Object.defineProperty,g=(e,t)=>He(e,"name",{value:t,configurable:!0}),w=ze(),Oe=Symbol.for("satori.element");function Z(e){return e&&typeof e=="object"&&e[Oe]}g(Z,"isElement");function ae(e){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){if(e=""+e,e)return $("text",{content:e})}else{if(Z(e))return e;if(!(0,w.isNullable)(e))throw new TypeError(`Invalid content: ${e}`)}}g(ae,"toElement");function V(e){return Array.isArray(e)?e.map(ae).filter(t=>t):[ae(e)].filter(t=>t)}g(V,"toElementArray");var G=class{get data(){return this.attrs}toString(e=!1){if(this.type==="text")return e?this.attrs.content:$.escape(this.attrs.content);let t=this.children.map(i=>i.toString(e)).join("");if(e)return t;let r=Object.entries(this.attrs).map(([i,p])=>(0,w.isNullable)(p)?"":(i=(0,w.hyphenate)(i),p===!0?` ${i}`:p===!1?` no-${i}`:` ${i}="${$.escape(""+p,!0)}"`)).join("");return this.children.length?`<${this.type}${r}>${t}</${this.type}>`:`<${this.type}${r}/>`}};g(G,"ElementConstructor");(0,w.defineProperty)(G,"name","Element");(0,w.defineProperty)(G.prototype,Oe,!0);function $(e,...t){let r=Object.create(G.prototype),i={},p=[];if(t[0]&&typeof t[0]=="object"&&!Z(t[0])&&!Array.isArray(t[0])){let z=t.shift();for(let[A,m]of Object.entries(z))(0,w.isNullable)(m)||(A==="children"?t.push(...(0,w.makeArray)(m)):i[A]=m)}for(let z of t)p.push(...V(z));return Object.assign(r,{type:e,attrs:i,children:p})}g($,"Element");var Je=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(e=>{e.jsx=e,e.jsxs=e,e.jsxDEV=e,e.Fragment="template";function t(s,n){return typeof s!="string"?V(s):e.parse(s,n)}e.normalize=t,g(t,"normalize");function r(s,n=!1){let o=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return n?o.replace(/"/g,"&quot;"):o}e.escape=r,g(r,"escape");function i(s){return s.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(n,o)=>o==="38"?n:String.fromCharCode(+o)).replace(/&#x([0-9a-f]+);/gi,(n,o)=>o==="26"?n:String.fromCharCode(parseInt(o,16))).replace(/&(amp|#38|#x26);/g,"&")}e.unescape=i,g(i,"unescape");function p(s,n={}){var o;let l=a(s);return n.caret?n.type&&((o=l[0])==null?void 0:o.type)!==n.type?void 0:l[0]:m(l,n.type||"*")[0]}e.from=p,g(p,"from");let z=/ *([ >+~]) */g;function A(s){return s.split(",").map(n=>{let o=[];n=n.trim();let l,b=" ";for(;l=z.exec(n);)o.push({type:n.slice(0,l.index),combinator:b}),b=l[1],n=n.slice(l.index+l[0].length);return o.push({type:n,combinator:b}),o})}e.parseSelector=A,g(A,"parseSelector");function m(s,n){if(typeof s=="string"&&(s=a(s)),typeof n=="string"&&(n=A(n)),!n.length)return;let o=[],l=[];for(let[b,F]of s.entries()){let C=[],y=[...n,...o];o=[];let D=!1;for(let u of y){let{type:h,combinator:d}=u[0];(h===F.type||h==="*")&&(u.length===1?D=!0:[" ",">"].includes(u[1].combinator)?C.push(u.slice(1)):u[1].combinator==="+"?o.push(u.slice(1)):n.push(u.slice(1))),d===" "&&C.push(u)}D&&l.push(s[b]),l.push(...m(F.children,C))}return l}e.select=m,g(m,"select");function v(s,n){var o;if(s=s.trim(),!/^[\w.]+$/.test(s))return(o=Je(s,n))!=null?o:"";let l=n;for(let b of s.split("."))if(l=l[b],(0,w.isNullable)(l))return"";return l??""}e.interpolate=v,g(v,"interpolate");let S=/<!--[\s\S]*?-->|<(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>/,j=/([^\s=]+)(?:="([^"]*)"|='([^']*)')?/g,_=/([^\s=]+)(?:="([^"]*)"|='([^']*)'|=\{([^}]+)\})?/g,P=/\{([^}]*)\}/;function a(s,n){let o=[];function l(u){u&&o.push(e("text",{content:u}))}g(l,"pushText");let b=n?_:j,F;for(;F=S.exec(s);){C(s.slice(0,F.index));let[u,h,d,H,J]=F;if(s=s.slice(F.index+u.length),u.startsWith("<!"))continue;let q={source:u,type:d||e.Fragment,close:h,empty:J,attrs:{}},se;for(;se=b.exec(H);){let[rt,E,Ne,oe=Ne,ue]=se;ue?q.attrs[(0,w.camelize)(E)]=v(ue,n):(0,w.isNullable)(oe)?E.startsWith("no-")?q.attrs[(0,w.camelize)(E.slice(3))]=!1:q.attrs[(0,w.camelize)(E)]=!0:q.attrs[(0,w.camelize)(E)]=i(oe)}o.push(q)}C(s);function C(u){if(u=u.replace(/^\s*\n\s*/,"").replace(/\s*\n\s*$/,""),n){let h;for(;h=P.exec(u);){let[d,H]=h;l(i(u.slice(0,h.index))),u=u.slice(h.index+d.length);let J=v(H,n);o.push(...V(J))}}l(i(u))}g(C,"parseContent");let y=[e(e.Fragment)];function D(u){for(;u>0;u--){let{children:h}=y.shift(),{source:d}=y[0].children.pop();y[0].children.push(e("text",{content:d})),y[0].children.push(...h)}}g(D,"rollback");for(let u of o)if(Z(u))y[0].children.push(u);else if(u.close){let h=0;for(;h<y.length&&y[h].type!==u.type;)h++;if(h===y.length)y[0].children.push(e("text",{content:u.source}));else{D(h);let d=y.shift();delete d.source}}else{let h=e(u.type,u.attrs);y[0].children.push(h),u.empty||(h.source=u.source,y.unshift(h))}return D(y.length-1),y[0].children}e.parse=a,g(a,"parse");function c(s,n,o){let l=typeof s=="string"?a(s):s,b=[];return l.forEach(F=>{var C,y;let{type:D,attrs:u,children:h}=F,d=(y=(C=n[D])!=null?C:n.default)!=null?y:!0;typeof d=="function"&&(d=d(u,h,o)),d===!0?b.push(e(D,u,c(h,n,o))):d!==!1&&b.push(...t(d))}),typeof s=="string"?b.join(""):b}e.transform=c,g(c,"transform");async function k(s,n,o){let l=typeof s=="string"?a(s):s,b=(await Promise.all(l.map(async F=>{var C,y;let{type:D,attrs:u,children:h}=F,d=(y=(C=n[D])!=null?C:n.default)!=null?y:!0;return typeof d=="function"&&(d=await d(u,h,o)),d===!0?[e(D,u,await k(h,n,o))]:d!==!1?t(d):[]}))).flat(1);return typeof s=="string"?b.join(""):b}e.transformAsync=k,g(k,"transformAsync");function M(s,...n){return(...o)=>{let l=e(s);return n.forEach((b,F)=>{(0,w.isNullable)(o[F])||(l.attrs[b]=o[F])}),o[n.length]&&Object.assign(l.attrs,o[n.length]),l}}g(M,"createFactory"),e.warn=g(()=>{},"warn");function N(s){return(n,...o)=>{let l="base64://";return typeof o[0]=="string"&&(l=`data:${o.shift()};base64,`),(0,w.is)("Buffer",n)?n=l+n.toString("base64"):(0,w.is)("ArrayBuffer",n)&&(n=l+(0,w.arrayBufferToBase64)(n)),n.startsWith("base64://")&&(0,e.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),e(s,{...o[0],url:n})}}g(N,"createAssetFactory"),e.text=M("text","content"),e.at=M("at","id"),e.sharp=M("sharp","id"),e.quote=M("quote","id"),e.image=N("image"),e.video=N("video"),e.audio=N("audio"),e.file=N("file")})($||($={}));Se.exports=$});var W={};import*as ot from"https://registry.koishi.chat/modules/koishi/index.js";var Be=We(()=>{T(W,ot)});var Pe=L((ut,Xe)=>{Xe.exports={name:"koishi-plugin-music",description:"Share Music in Koishi",version:"2.2.1",main:"lib/index.js",typings:"lib/index.d.ts",files:["lib","dist"],author:"Shigma <shigma10826@gmail.com>",license:"MIT",repository:{type:"git",url:"git+https://github.com/koishijs/koishi-plugin-music.git"},bugs:{url:"https://github.com/koishijs/koishi-plugin-music/issues"},homepage:"https://github.com/koishijs/koishi-plugin-music",scripts:{build:"tsc -b"},keywords:["chatbot","koishi","plugin","music","share","search","netease","qq"],koishi:{browser:!0,description:{en:"Share music (supports QQ Music and Netease Cloud Music)",zh:"分享音乐（目前支持 QQ 音乐和网易云音乐）"},service:{optional:["puppeteer"]}},peerDependencies:{koishi:"^4.10.3","koishi-plugin-puppeteer":"^3.4.1"},peerDependenciesMeta:{"koishi-plugin-puppeteer":{optional:!0}},devDependencies:{"@types/node":"^18.11.18",koishi:"^4.11.3",typescript:"^4.9.4"}}});var tt=L(O=>{Object.defineProperty(O,"__esModule",{value:!0});O.apply=O.name=O.Config=void 0;var x=$e(),B=(Be(),Le(W)),{version:Te}=Pe();O.Config=B.Schema.object({platform:B.Schema.union(["netease","qq"]).default("qq").description("默认的点歌平台。"),imageMode:B.Schema.boolean().default(!0).description("是否使用图片模式 (需要 puppeteer 服务)。"),showWarning:B.Schema.boolean().default(!1).description("点歌失败时是否发送提示。")});var Me={async netease(e){let t=await this.http.get("http://music.163.com/api/cloudsearch/pc",{params:{s:e,type:1,offset:0,limit:5}});if(!(t.code!==200||t.result.songCount===0))return t.result.songs.map(r=>({type:"163",id:r.id,name:r.name,artist:r.ar.map(i=>i.name).join("/"),url:`https://music.163.com/#/song?id=${r.id}`,album:r.al.name}))},async qq(e){let t=await this.http.get("https://c.y.qq.com/splcloud/fcgi-bin/smartbox_new.fcg",{params:{key:e,format:"json"}});if(!(t.code||t.data.song.count===0))return t.data.song.itemlist.map(r=>({type:"qq",id:r.id,name:r.name,artist:r.singer,url:`https://y.qq.com/n/ryqq/songDetail/${r.mid}`,album:""}))}};O.name="music";function et(e,t){let{showWarning:r,platform:i,imageMode:p}=t;function z(A){return p&&e.puppeteer?(0,x.jsxs)("html",{style:{color:"#ffffff",background:"#333333",padding:"1rem"},children:[(0,x.jsx)("style",{children:`
          th, td {
            padding: 0.25rem 0.5rem;
          }
          .index, .title {
            text-align: center;
          }
        `}),(0,x.jsx)("p",{children:"我们找到了多个可能符合条件的歌曲，请输入序号进行选择："}),(0,x.jsxs)("table",{children:[(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{class:"index",children:"编号"}),(0,x.jsx)("th",{class:"title",children:"名称"}),(0,x.jsx)("th",{children:"歌手"})]}),A.map((m,v)=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{children:v+1}),(0,x.jsx)("td",{children:m.name}),(0,x.jsx)("td",{children:m.artist})]}))]}),(0,x.jsxs)("p",{children:["Generated by Koishi v",B.version," / koishi-plugin-music v",Te]})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("p",{children:"我们找到了多个可能符合条件的歌曲，请输入序号进行选择："}),A.map((m,v)=>(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("p",{children:[v+1,". ",m.name," ",m.artist," ",m.album]})}))]})}e.command("music <name:text>","点歌").option("platform",`-p <platform>  点歌平台，目前支持 qq, netease，默认为 ${i}`,{type:Object.keys(Me)}).alias("点歌").shortcut("来一首",{fuzzy:!0}).shortcut("点一首",{fuzzy:!0}).shortcut("整一首",{fuzzy:!0}).action(async({session:A,options:m},v)=>{m.platform||(m.platform=i);let S=Me[m.platform];if(!S)return`目前不支持平台 ${m.platform}。`;if(!v)return"请输入歌曲相关信息。";try{let j=await S.call(e,v);if(Array.isArray(j)&&j.length>0){if(j.length>1){await A.send(z(j));let c=await A.prompt();if(!c||Number.isNaN(+c))return"请输入正确的序号。";let k=+c-1;return j[k]?(0,B.segment)("onebot:music",j[k],`${j[k].name}
${j[k].artist}
${j[k].url}`):"请输入正确的序号。"}let{name:_,artist:P,url:a}=j[0];return(0,B.segment)("onebot:music",j,`${_}
${P}
${a}`)}}catch{}if(r)return"点歌失败，请尝试更换平台。"})}O.apply=et});export default tt();
