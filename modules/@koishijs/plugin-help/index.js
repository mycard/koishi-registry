var j=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var E=(e,t)=>()=>(e&&(t=e(e=0)),t);var D=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _=(e,t,i,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of T(t))!k.call(e,l)&&l!==i&&j(e,l,{get:()=>t[l],enumerable:!(a=N(t,l))||a.enumerable});return e},x=(e,t,i)=>(_(e,t,"default"),i&&_(i,t,"default"));var U=e=>_(j({},"__esModule",{value:!0}),e);var f={};import*as te from"https://registry.koishi.chat/modules/koishi/index.js";var A=E(()=>{x(f,te)});var Z=D((ae,S)=>{var v=Object.defineProperty,B=Object.getOwnPropertyDescriptor,J=Object.getOwnPropertyNames,L=Object.prototype.hasOwnProperty,h=(e,t)=>v(e,"name",{value:t,configurable:!0}),M=(e,t)=>{for(var i in t)v(e,i,{get:t[i],enumerable:!0})},V=(e,t,i,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of J(t))!L.call(e,l)&&l!==i&&v(e,l,{get:()=>t[l],enumerable:!(a=B(t,l))||a.enumerable});return e},W=e=>V(v({},"__esModule",{value:!0}),e),P={};M(P,{Config:()=>X,apply:()=>C,enableHelp:()=>b,name:()=>Y});S.exports=W(P);var y=(A(),U(f)),R={commands:{help:{description:"显示帮助信息",shortcuts:{help:"帮助"},options:{help:"显示此信息",authority:"显示权限设置",showHidden:"查看隐藏的选项和指令"},messages:{"not-found":"指令未找到。","hint-authority":"括号内为对应的最低权限等级","hint-subcommand":"标有星号的表示含有子指令","command-aliases":"别名：{0}。","command-examples":"使用示例：","command-authority":"最低权限：{0} 级。","subcommand-prolog":"可用的子指令有{0}：","global-prolog":"当前可用的指令有{0}：","global-epilog":"输入“帮助 指令名”查看特定指令的语法和使用示例。","available-options":"可用的选项有：","available-options-with-authority":"可用的选项有（括号内为额外要求的权限等级）："}}}},G={commands:{help:{description:"Show help",options:{help:"show this message",authority:"show authority requirements",showHidden:"show hidden options and commands"},messages:{"not-found":"Command not found.","hint-authority":"this minimum authority is marked in parentheses","hint-subcommand":"those marked with an asterisk have subcommands","command-aliases":"Aliases: {0}.","command-examples":"Examples:","command-authority":"Minimal authority: {0}.","subcommand-prolog":"Available subcommands{0}:","global-prolog":"Available commands{0}:","global-epilog":'Type "help <command>" to see syntax and examples for a specific command.',"available-options":"Available options:","available-options-with-authority":"Available options (parentheses indicate additional authority requirement):"}}}},I={commands:{help:{description:"ヘルプを表示",options:{help:"このメッセージを表示",authority:"コマンドやオプションの権限を表示",showHidden:"隠しコマンドやオプションを表示"},messages:{"not-found":"コマンドが見つかりません。","hint-authority":"最低権限は括弧にで表示されています","hint-subcommand":"サブコマンドがあるコマンドはアスタリスクで表示されています","command-aliases":"別名: {0}。","command-examples":"例：","command-authority":"最低権限：{0}。","subcommand-prolog":"利用可能なサブコマンド{0}：","global-prolog":"利用可能なコマンド{0}：","global-epilog":"「help <command>」を送信してコマンドの使い方を表示します。","available-options":"利用可能なオプション：","available-options-with-authority":"利用可能なオプション（必要な権限は括弧にで表示されています）："}}}},K={commands:{help:{description:"Afficher l'aide",options:{help:"afficher cette aide",authority:"afficher les droits nécessaires",showHidden:"afficher les options et commandes cachées"},messages:{"not-found":"Commande inconnue.","hint-authority":"les droits minimums sont indiqués entre parenthèses","hint-subcommand":"ces commandes avec un astérisque ont des sous-commandes","command-aliases":"Alias : {0}.","command-examples":"Exemples :","command-authority":"Droit minimum : {0}.","subcommand-prolog":"Commandes disponibles{0} :","global-prolog":"Commandes disponibles{0} :","global-epilog":'Tapez "help <commande>" pour voir la syntaxe et les exemples pour une commande spécifique.',"available-options":"Options disponibles :","available-options-with-authority":"Options disponibles (les parenthèses indiquent un droit supplémentaire) :"}}}},Q={commands:{help:{description:"顯示幫助信息",options:{help:"顯示當前信息",authority:"顯示權限設定",showHidden:"顯示隱藏的指令和選項"},messages:{"not-found":"未找到指令。","hint-authority":"括弧内為對應的最低權限","hint-subcommand":"附有星號的表示其包含子指令","command-aliases":"別名：{0}。","command-examples":"使用示例：","command-authority":"最低權限：{0} 級。","subcommand-prolog":"可用的子指令有{0}：","global-prolog":"當前可用的子指令有{0}：","global-epilog":"輸入「help 指令名」檢視特定指令的語法及使用示例。","available-options":"可用的選項有：","available-options-with-authority":"可用的選項有（括弧表示額外的權限要求）："}}}},X=y.Schema.object({shortcut:y.Schema.boolean().default(!0).description("是否启用快捷调用。"),options:y.Schema.boolean().default(!0).description("是否为每个指令添加 `-h, --help` 选项。")});function b(e){return e._disposables=e.ctx.registry.get(C).disposables,e.option("help","-h",{hidden:!0,notUsage:!0,descPath:"commands.help.options.help"})}h(b,"enableHelp");function w(e,t){if(e.app.$commander.getCommand("help"))return e.execute({name:"help",args:[t]})}h(w,"executeHelp");var Y="help";function C(e,t){e.i18n.define("zh",R),e.i18n.define("en",G),e.i18n.define("ja",I),e.i18n.define("fr",K),e.i18n.define("zh-TW",Q),t.options!==!1&&(e.$commander._commandList.forEach(r=>r.use(b)),e.on("command-added",r=>r.use(b))),e.before("command/execute",r=>{let{command:n,options:s,session:m}=r;if(s.help&&n._options.help)return w(m,n.name);if(!n._actions.length)return w(m,n.name)});let i=e.$commander;function a(r,n){let s=i.resolve(r);if(s?.match(n))return s;let m=e.i18n.find("commands.(name).shortcuts.(variant)",r).map(u=>({...u,command:i.resolve(u.data.name)})).filter(u=>{var c;return(c=u.command)==null?void 0:c.match(n)}),p=m.filter(u=>u.similarity===1);return p.length?p[0].command:m}h(a,"findCommand");let l=h(r=>(n,s)=>{let{args:[m],session:p}=n,u=a(m,p);if(!Array.isArray(u)){p.collect(r,{...n,command:u,args:[],options:{help:!0}},s);return}for(let{command:c}of u)p.collect(r,{...n,command:c,args:[],options:{help:!0}},s)},"createCollector");async function o(r,n){let s=a(r,n);if(!Array.isArray(s))return s;let m=i.available(n).filter(u=>u&&n.app.i18n.compare(u,r));for(let u of s)m.includes(u.data.name)||m.push(u.data.name);let p=await n.suggest({expect:m,prefix:n.text(".not-found"),suffix:n.text("internal.suggest-command")});return i.resolve(p)}h(o,"inferCommand");let d=e.command("help [command:string]",{authority:0,...t}).userFields(["authority"]).userFields(l("user")).channelFields(l("channel")).option("authority","-a").option("showHidden","-H").action(async(r,n)=>{let{session:s,options:m}=r;if(!n){let u=i._commandList.filter(F=>F.parent===null),c=$(".global-prolog",s,u,m),g=s.text(".global-epilog");return g&&c.push(g),c.filter(Boolean).join(`
`)}let p=await o(n,s);if(p)return z(p,s,m)});t.shortcut!==!1&&d.shortcut("help",{i18n:!0,fuzzy:!0})}h(C,"apply");function*H(e,t,i=!1){for(let a of t)!i&&a.config.hidden||(a.match(e)?yield a:yield*H(e,a.children,i))}h(H,"getCommands");function $(e,t,i,a){let l=Array.from(H(t,i,a.showHidden)).sort((s,m)=>s.displayName>m.displayName?1:-1);if(!l.length)return[];let o=!1,d=l.map(({name:s,displayName:m,config:p,children:u})=>{let c="    "+m;if(a.authority){let g=t.resolve(p.authority);c+=` (${g}${u.length?(o=!0,"*"):""})`}return c+="  "+t.text([`commands.${s}.description`,""],p.params),c}),r=[];a.authority&&r.push(t.text(".hint-authority")),o&&r.push(t.text(".hint-subcommand"));let n=r.length?t.text("general.paren",[r.join(t.text("general.comma"))]):"";return d.unshift(t.text(e,[n])),d}h($,"formatCommands");function O(e,t){return t.user&&e.authority>t.user.authority?!1:!t.resolve(e.hidden)}h(O,"getOptionVisibility");function q(e,t,i){if(e.config.hideOptions&&!i.showHidden)return[];let a=i.showHidden?Object.values(e._options):Object.values(e._options).filter(o=>O(o,t));if(!a.length)return[];let l=[];return Object.values(e._options).forEach(o=>{let d=o.authority&&i.authority?`(${o.authority}) `:"";function r(n,s){var m;if(!i.showHidden&&!O(n,t))return;let p=`${d}${y.segment.escape(n.syntax)}`,u=t.text((m=n.descPath)!=null?m:[`commands.${e.name}.options.${s}`,""],n.params);u&&(p+="  "+u),p=e.ctx.chain("help/option",p,n,e,t),l.push("    "+p)}h(r,"pushOption"),"value"in o||r(o,o.name);for(let n in o.variants)r(o.variants[n],`${o.name}.${n}`)}),l.length?(l.unshift(i.authority&&a.some(o=>o.authority)?t.text(".available-options-with-authority"):t.text(".available-options")),l):[]}h(q,"getOptions");async function z(e,t,i){let a=[e.displayName+y.segment.escape(e.declaration)],l=t.text([`commands.${e.name}.description`,""],e.config.params);if(l&&a.push(l),t.app.database){let o={command:e,args:[],options:{help:!0}},d=t.collect("user",o);if(await t.observeUser(d),t.subtype==="group"){let r=t.collect("channel",o);await t.observeChannel(r)}}if(e._aliases.length>1&&a.push(t.text(".command-aliases",[Array.from(e._aliases.slice(1)).join("，")])),t.app.emit(t,"help/command",a,e,t),t.user){let o=t.resolve(e.config.authority);o>1&&a.push(t.text(".command-authority",[o]))}if(e._usage)a.push(typeof e._usage=="string"?e._usage:await e._usage(t));else{let o=t.text([`commands.${e.name}.usage`,""]);o&&a.push(o)}if(a.push(...q(e,t,i)),e._examples.length)a.push(t.text(".command-examples"),...e._examples.map(o=>"    "+o));else{let o=t.text([`commands.${e.name}.examples`,""]);o&&a.push(...o.split(`
`).map(d=>"    "+d))}return a.push(...$(".subcommand-prolog",t,e.children,i)),a.filter(Boolean).join(`
`)}h(z,"showHelp")});export default Z();
