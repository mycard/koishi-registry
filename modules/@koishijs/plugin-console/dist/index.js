import{reactive as U,defineComponent as $,computed as R,resolveComponent as l,openBlock as c,createBlock as m,withCtx as h,createElementVNode as p,toDisplayString as A,createElementBlock as _,createCommentVNode as C,unref as u,createVNode as d,withModifiers as q,renderSlot as z,Fragment as w,renderList as S,resolveDirective as G,normalizeClass as H,KeepAlive as J,resolveDynamicComponent as Q,withDirectives as X,createTextVNode as L,createApp as Y}from"./vue.js";import{useWindowSize as Z,useLocalStorage as ee,useDark as te}from"./vueuse.js";import ne,{router as E,activities as oe,store as se,isLeftAsideOpen as ce,socket as W,config as N,root as D,connect as V}from"./client.js";import{useRoute as ie}from"./vue-router.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();const T=U({});E.afterEach(()=>{const{name:e,fullPath:t}=E.currentRoute.value;T[e]=t});const re={class:"title"},ae={key:0,class:"desc"},O=$({__name:"activity-item",props:{data:null,placement:null},setup(e){const t=e,i=R(()=>T[t.data.id]||t.data.path.replace(/:.+/,""));return(r,o)=>{const n=l("k-icon"),s=l("router-link"),y=l("el-tooltip");return c(),m(y,{placement:e.placement,"popper-class":"activity-item-tooltip"},{content:h(()=>[p("div",re,A(e.data.name),1),e.data.desc?(c(),_("div",ae,A(e.data.desc),1)):C("",!0)]),default:h(()=>[e.data.path?(c(),m(s,{key:0,class:"navbar-item",to:u(i)},{default:h(()=>[d(n,{class:"menu-icon",name:e.data.icon},null,8,["name"])]),_:1},8,["to"])):(c(),_("div",{key:1,class:"navbar-item",onClick:o[0]||(o[0]=q((...f)=>e.data.action&&e.data.action(...f),["stop"]))},[d(n,{class:"menu-icon",name:e.data.icon},null,8,["name"])]))]),_:1},8,["placement"])}}});const P=(e,t)=>{const i=e.__vccOpts||e;for(const[r,o]of t)i[r]=o;return i},le={},ue={class:"navbar-item"};function _e(e,t){const i=l("k-icon"),r=l("el-tooltip");return c(),m(r,{placement:"right","popper-class":"activity-group-tooltip"},{content:h(()=>[z(e.$slots,"default")]),default:h(()=>[p("div",ue,[d(i,{class:"menu-icon",name:"activity:ellipsis"})])]),_:3})}const de=P(le,[["render",_e]]),me={class:"layout-activity"},pe={key:1,class:"spacer"},fe=$({__name:"activity-bar",setup(e){const{height:t,width:i}=Z(),r=R(()=>{let o;const n=i.value<=768?56:64,s=Object.values(oe).filter(a=>a.position).sort((a,k)=>a.order-k.order);s.length*n>t.value&&(o=s.splice(0,s.length+1-Math.floor(t.value/n)).sort((a,k)=>{const g=a.position==="top"?-1:1;return a.position===k.position?g*(a.order-k.order):g}));const y=s.filter(a=>a.position==="top").reverse(),f=s.filter(a=>a.position==="bottom");return{top:y,bottom:f,hidden:o}});return(o,n)=>(c(),_("nav",me,[(c(!0),_(w,null,S(u(r).top,s=>(c(),m(O,{placement:"right",key:s.id,data:s},null,8,["data"]))),128)),u(r).hidden?(c(),m(de,{key:0},{default:h(()=>[(c(!0),_(w,null,S(u(r).hidden,s=>(c(),m(O,{placement:"bottom",key:s.id,data:s},null,8,["data"]))),128))]),_:1})):(c(),_("div",pe)),(c(!0),_(w,null,S(u(r).bottom,s=>(c(),m(O,{placement:"right",key:s.id,data:s},null,8,["data"]))),128))]))}});const he=P(fe,[["__scopeId","data-v-2d95dbba"]]);const ve={},ke={class:"layout-status"};function ye(e,t){const i=l("k-slot");return c(),_("footer",ke,[d(i,{name:"status-left"}),d(i,{name:"status-right"})])}const ge=P(ve,[["render",ye]]),be={key:1,class:"loading","element-loading-text":"正在加载数据……"},$e=$({__name:"index",setup(e){const t=ie(),i=R(()=>{var r;return(r=t.meta.activity)!=null&&r.fields?t.meta.activity.fields.every(o=>se[o]):!0});return(r,o)=>{const n=l("router-view"),s=l("k-slot"),y=G("loading");return c(),_("div",{class:H({"is-left-aside-open":u(ce)})},[d(he),u(i)?(c(),m(n,{key:0},{default:h(({Component:f})=>[(c(),m(J,null,[(c(),m(Q(f)))],1024))]),_:1})):X((c(),_("div",be,null,512)),[[y,!0]]),d(ge),d(s,{name:"global"})],2)}}}),we={class:"k-card welcome"},xe=p("h1",null,"欢迎使用 Koishi！",-1),Ce=p("p",null,"你的机器人已经准备就绪。点击下面的任一选项，开启你的 Koishi 之旅吧。",-1),Se=p("h2",null,"阅读文档",-1),Le=p("p",null,"开始阅读官方文档。官方文档里包含了你想要了解的全部内容。",-1),Ee=[Se,Le],Be=p("h2",null,"前往论坛",-1),Oe=p("p",null,"前往论坛与其他用户交流。如果你遇到了问题，可以在这里寻求帮助。",-1),Ae=[Be,Oe],Ne=$({__name:"welcome",setup(e){function t(i){window.open(i,"_blank","noopener noreferrer")}return(i,r)=>{const o=l("k-slot");return c(),_("div",we,[xe,Ce,d(o,{name:"welcome-choice",class:"choices"},{default:h(()=>[p("div",{class:"choice",onClick:r[0]||(r[0]=n=>t("https://koishi.chat"))},Ee),p("div",{class:"choice",onClick:r[1]||(r[1]=n=>t("https://k.ilharp.cc"))},Ae)]),_:1})])}}});const Re={key:1},De=$({__name:"home",setup(e){return(t,i)=>{const r=l("k-slot"),o=l("el-scrollbar"),n=l("k-card"),s=l("k-layout");return c(),m(s,{main:`darker page-home${u(W)?"":" loading"}`},{default:h(()=>[u(W)?(c(),m(o,{key:0},{default:h(()=>[d(Ne),d(r,{name:"home"}),d(r,{name:"numeric",class:"card-grid profile-grid"}),d(r,{name:"chart",class:"card-grid chart-grid"})]),_:1})):(c(),_("div",Re,[d(n,{class:"connect"},{default:h(()=>[L("正在连接到 Koishi 服务器……")]),_:1})]))]),_:1},8,["main"])}}});const Pe="modulepreload",Ke=function(e){return"/"+e},j={},We=function(t,i,r){if(!i||i.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=Ke(n),n in j)return;j[n]=!0;const s=n.endsWith(".css"),y=s?'[rel="stylesheet"]':"";if(!!r)for(let k=o.length-1;k>=0;k--){const g=o[k];if(g.href===n&&(!s||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${y}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":Pe,s||(a.as="script",a.crossOrigin=""),a.href=n,document.head.appendChild(a),s)return new Promise((k,g)=>{a.addEventListener("load",k),a.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())},I=1;function Ve(e){const t=ee("koishi-play",{});return t.value.version!==I?t.value={...e,version:I}:t.value={...e,...t.value},t}const v=Ve({current:null,instances:{}});let b;function F(){const e=Math.random().toString(36).slice(2,10);v.value.current=e,v.value.instances[e]={plugins:{console:{},help:{},sandbox:{},market:{}}},b&&K(e)}async function K(e){var i;await((i=b.app)==null?void 0:i.stop()),v.value.current=e,b.config=v.value.instances[e],await(await b.createApp()).start()}Object.keys(v.value.instances).length||F();async function je(){if(b)return b;const e=N.endpoint+"/modules/@koishijs/loader/index.js",{default:t}=await We(()=>import(e),[]);return b=new t}const Ie=p("span",null,"实例管理",-1),Te={class:"name"},Fe={class:"actions"},Me=$({__name:"index",setup(e){function t(i){delete v.value.instances[i]}return(i,r)=>{const o=l("k-button"),n=l("k-icon"),s=l("k-card");return c(),m(s,{class:"instances"},{header:h(()=>[Ie,d(o,{class:"right",onClick:u(F)},{default:h(()=>[L("添加")]),_:1},8,["onClick"])]),default:h(()=>[p("table",null,[(c(!0),_(w,null,S(u(v).instances,(y,f)=>(c(),_("tr",{class:"instance",key:f},[p("td",Te,[L(A(y.name||f)+" ",1),u(v).current===f?(c(),_(w,{key:0},[L("(运行中)")],64)):C("",!0)]),p("td",Fe,[p("span",null,[u(v).current!==f?(c(),m(n,{key:0,name:"start",onClick:a=>u(K)(f)},null,8,["onClick"])):C("",!0),u(v).current!==f?(c(),m(n,{key:1,name:"delete",onClick:a=>t(f)},null,8,["onClick"])):C("",!0)])])]))),128))])]),_:1})}}});class M{onopen(t){}onmessage(t){}onclose(t){}onerror(t){}send(t){this.remote.onmessage({data:t})}}class Ue extends M{constructor(t){super(),this.remote=t,this.start()}async start(){const t=await je();t[Symbol.for("koishi.socket")]=this,await K(v.value.current)}}class qe extends M{constructor(){super(),this.remote=new Ue(this),this.onopen({}),D.slot({type:"home",order:900,component:Me})}}const B=Y($e);B.use(ne);B.provide("ecTheme","dark-blue");D.page({path:"/",name:"欢迎",icon:"activity:home",order:1e3,component:De});const x=te();D.page({id:"dark-mode",position:"bottom",order:-100,name:()=>x.value?"暗黑模式":"明亮模式",icon:()=>"activity:"+(x.value?"moon":"sun"),action:()=>x.value=!x.value});B.use(E);E.afterEach(e=>{e.meta.activity&&(document.title=`${e.meta.activity.name} | Koishi 控制台`)});B.mount("#app");if(N.static)V(()=>new qe);else{const e=new URL(N.endpoint,location.origin).toString();V(()=>new WebSocket(e.replace(/^http/,"ws")))}
