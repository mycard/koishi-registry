var Ut="4.11.6";var gt=Object.defineProperty,Wt=Object.getOwnPropertyNames,Bt=(e,t,r)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ht=(e,t)=>gt(e,"name",{value:t,configurable:!0}),Qt=(e,t)=>function(){return t||(0,e[Wt(e)[0]])((t={exports:{}}).exports,t),t.exports},Kt=(e,t,r)=>(Bt(e,typeof t!="symbol"?t+"":t,r),r),Vt=Qt({"packages/inaba/src/index.ts"(e,t){var r=class{constructor(s=Math.random){this.get=s}id(s=8,o=16){let a="";for(let c=0;c<s;++c)a+=r.chars[Math.floor(Math.random()*o)];return a}bool(s){return s>=1?!0:s<=0?!1:this.get()<s}real(...s){let o=s.length>1?s[0]:0,a=s[s.length-1];return this.get()*(a-o)+o}int(...s){return Math.floor(this.real(...s))}splice(s){return s.splice(Math.floor(this.get()*s.length),1)[0]}pick(s,o){if(o===void 0)return this.pick(s,1)[0];let a=s.slice(),c=[];o=Math.min(a.length,o);for(let d=0;d<o;d+=1)c.push(this.splice(a));return c}shuffle(s){return this.pick(s,s.length)}weightedPick(s){let o=Object.entries(s).reduce((d,[,b])=>d+b,0),a=this.get()*o,c=0;for(let d in s)if(c+=s[d],a<c)return d}},n=r;Ht(n,"Random"),Kt(n,"chars","0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");var i=new n;for(let s of["id","bool","int","real","splice","pick","shuffle","weightedPick"])n[s]=i[s].bind(i);t.exports=n}}),he=Vt();var Xt=Object.defineProperty,$=(e,t)=>Xt(e,"name",{value:t,configurable:!0});function De(){}$(De,"noop");function I(e){return e==null}$(I,"isNullable");function Gt(e){return e&&typeof e=="object"&&!Array.isArray(e)}$(Gt,"isPlainObject");function ae(e,t){return Object.fromEntries(Object.entries(e).map(([r,n])=>[r,t(n,r)]))}$(ae,"valueMap");function oe(e,t){return e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}$(oe,"is");function pe(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(pe):oe("Date",e)?new Date(e.valueOf()):oe("RegExp",e)?new RegExp(e.source,e.flags):ae(e,pe)}$(pe,"clone");function de(e,t,r){return e===t||!r&&I(e)&&I(t)?!0:typeof e!=typeof t||typeof e!="object"||!e||!t?!1:Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every((n,i)=>de(n,t[i])):Array.isArray(t)?!1:Object.keys({...e,...t}).every(n=>de(e[n],t[n]))}$(de,"deepEqual");function Yt(e,t,r){if(!t)return{...e};let n={};for(let i of t)(r||i in e)&&(n[i]=e[i]);return n}$(Yt,"pick");function Jt(e,t){if(!t)return{...e};let r={...e};for(let n of t)Reflect.deleteProperty(r,n);return r}$(Jt,"omit");function g(e,t,r){return Object.defineProperty(e,t,{writable:!0,value:r})}$(g,"defineProperty");function Zt(e,t){return t.every(r=>e.includes(r))}$(Zt,"contain");function er(e,t){return e.filter(r=>t.includes(r))}$(er,"intersection");function tr(e,t){return e.filter(r=>!t.includes(r))}$(tr,"difference");function rr(e,t){return Array.from(new Set([...e,...t]))}$(rr,"union");function nr(e){return[...new Set(e)]}$(nr,"deduplicate");function R(e,t){let r=e.indexOf(t);return r>=0?(e.splice(r,1),!0):!1}$(R,"remove");function K(e){return Array.isArray(e)?e:I(e)?[]:[e]}$(K,"makeArray");function ir(e){if(typeof Buffer<"u")return Buffer.from(e).toString("base64");let t="",r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}$(ir,"arrayBufferToBase64");function sr(e){if(typeof Buffer<"u")return Buffer.from(e,"base64").buffer;let t=atob(e.replace(/\s/g,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}$(sr,"base64ToArrayBuffer");function or(e){return e.charAt(0).toUpperCase()+e.slice(1)}$(or,"capitalize");function ze(e){return e.charAt(0).toLowerCase()+e.slice(1)}$(ze,"uncapitalize");function me(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}$(me,"camelCase");function ge(e){return ze(e).replace(/_/g,"-").replace(/.[A-Z]+/g,t=>t[0]+"-"+t.slice(1).toLowerCase())}$(ge,"paramCase");function ar(e){return ze(e).replace(/-/g,"_").replace(/.[A-Z]+/g,t=>t[0]+"_"+t.slice(1).toLowerCase())}$(ar,"snakeCase");var yt=me,Hr=ge;function bt(e){return e.replace(/\/$/,"")}$(bt,"trimSlash");function cr(e){return e.startsWith("/")||(e="/"+e),bt(e)}$(cr,"sanitize");var Q;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function r(m){t=m}e.setTimezoneOffset=r,$(r,"setTimezoneOffset");function n(){return t}e.getTimezoneOffset=n,$(n,"getTimezoneOffset");function i(m=new Date,h){return typeof m=="number"&&(m=new Date(m)),h===void 0&&(h=t),Math.floor((m.valueOf()/e.minute-h)/1440)}e.getDateNumber=i,$(i,"getDateNumber");function s(m,h){let _=new Date(m*e.day);return h===void 0&&(h=t),new Date(+_+h*e.minute)}e.fromDateNumber=s,$(s,"fromDateNumber");let o=/\d+(?:\.\d+)?/.source,a=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(m=>`(${o}${m})?`).join("")}$`);function c(m){let h=a.exec(m);return h?(parseFloat(h[1])*e.week||0)+(parseFloat(h[2])*e.day||0)+(parseFloat(h[3])*e.hour||0)+(parseFloat(h[4])*e.minute||0)+(parseFloat(h[5])*e.second||0):0}e.parseTime=c,$(c,"parseTime");function d(m){let h=c(m);return h?m=Date.now()+h:/^\d{1,2}(:\d{1,2}){1,2}$/.test(m)?m=`${new Date().toLocaleDateString()}-${m}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(m)&&(m=`${new Date().getFullYear()}-${m}`),m?new Date(m):new Date}e.parseDate=d,$(d,"parseDate");function b(m){let h=Math.abs(m);return h>=e.day-e.hour/2?Math.round(m/e.day)+"d":h>=e.hour-e.minute/2?Math.round(m/e.hour)+"h":h>=e.minute-e.second/2?Math.round(m/e.minute)+"m":h>=e.second?Math.round(m/e.second)+"s":m+"ms"}e.format=b,$(b,"format");function w(m,h=2){return m.toString().padStart(h,"0")}e.toDigits=w,$(w,"toDigits");function k(m,h=new Date){return m.replace("yyyy",h.getFullYear().toString()).replace("yy",h.getFullYear().toString().slice(2)).replace("MM",w(h.getMonth()+1)).replace("dd",w(h.getDate())).replace("hh",w(h.getHours())).replace("mm",w(h.getMinutes())).replace("ss",w(h.getSeconds())).replace("SSS",w(h.getMilliseconds(),3))}e.template=k,$(k,"template")})(Q||(Q={}));var lr=Object.defineProperty,D=(e,t)=>lr(e,"name",{value:t,configurable:!0});function ur(e){return typeof e=="number"&&Math.floor(e)===e}D(ur,"isInteger");async function Fe(e){return new Promise(t=>setTimeout(t,e))}D(Fe,"sleep");function fr(e){return Object.values(e).filter(t=>typeof t=="string")}D(fr,"enumKeys");function hr(e,t,r){e[t]=r,e[r]=t}D(hr,"defineEnumProperty");function vt(e,t){return Object.entries(t).forEach(([r,n])=>{if(typeof e[r]>"u")return e[r]=t[r];typeof n=="object"&&typeof e[r]=="object"&&(e[r]=vt(e[r],n))}),e}D(vt,"merge");function pr(e,t){if(!e[t])throw new Error(`missing configuration "${t}"`);return e[t]}D(pr,"assertProperty");function ye(e){let{message:t,stack:r}=e instanceof Error&&e.stack?e:new Error(e),n=r.split(`
`),i=n.findIndex(s=>s.endsWith(t));return n.slice(i).join(`
`)}D(ye,"coerce");function dr(e,t,r){e[t]=Reflect.get(e,r),Reflect.deleteProperty(e,r)}D(dr,"renameProperty");function be(e,t){Object.defineProperties(e,Object.getOwnPropertyDescriptors(t))}D(be,"extend");var Ne=["number","string","bigint","boolean","symbol","function"],mr=["Date","RegExp","Set","Map","WeakSet","WeakMap","Array"];function Te(e,t){return oe("Date",e)?xt(e,t):Array.isArray(e)?_t(e,t):qe(e,t)}D(Te,"observeProperty");function Re(e){return typeof e=="symbol"||e.startsWith("$")}D(Re,"untracked");function qe(e,t){let r=t;if(!t){let i=Object.create(null);g(e,"$diff",i),t=D(s=>{Re(s)||(i[s]=e[s])},"notify")}return new Proxy(e,{get(i,s){let o=Reflect.get(i,s);return!o||Ne.includes(typeof o)||Re(s)?o:Te(o,r||(()=>t(s)))},set(i,s,o){let a=i[s]===o,c=Reflect.set(i,s,o);return a||!c?c:(t(s),!0)},deleteProperty(i,s){let o=!(s in i),a=Reflect.deleteProperty(i,s);return o||!a?a:(t(s),!0)}})}D(qe,"observeObject");var gr=["pop","shift","splice","sort"];function _t(e,t){let r={};for(let n of gr)g(e,n,function(...i){return t(),Array.prototype[n].apply(this,i)});return new Proxy(e,{get(n,i){if(i in r)return r[i];let s=n[i];return!s||Ne.includes(typeof s)||typeof i=="symbol"||isNaN(i)?s:Te(s,t)},set(n,i,s){return typeof i!="symbol"&&!isNaN(i)&&n[i]!==s&&t(),Reflect.set(n,i,s)}})}D(_t,"observeArray");function xt(e,t){for(let r of Object.getOwnPropertyNames(Date.prototype))r!=="valueOf"&&g(e,r,function(...n){let i=e.valueOf(),s=Date.prototype[r].apply(this,n);return e.valueOf()!==i&&t(),s});return e}D(xt,"observeDate");function we(e,...t){if(Ne.includes(typeof e))throw new Error(`cannot observe immutable type "${typeof e}"`);if(!e)throw new Error("cannot observe null or undefined");let r=Object.prototype.toString.call(e).slice(8,-1);if(mr.includes(r))throw new Error(`cannot observe instance of type "${r}"`);let n=De;typeof t[0]=="function"&&(n=t.shift());let i=qe(e,null);return g(i,"$update",D(function(){let o={...this.$diff};if(Object.keys(o).length){for(let c in this.$diff)delete this.$diff[c];return n(o)}},"$update")),g(i,"$merge",D(function(o){for(let a in o){if(a in this.$diff)throw new Error(`unresolved diff key "${a}"`);e[a]=o[a]}return this},"$merge")),i}D(we,"observe");var wt=new Function("context","expr",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);function yr(e,t,r=/\{\{([\s\S]+?)\}\}/g){let n,i="",s=0;for(;n=r.exec(e);){if(n[0]===e)return wt(t,n[1]);i+=e.slice(s,n.index),i+=wt(t,n[1])??"",s=n.index+n[0].length}return i+e.slice(s)}D(yr,"interpolate");function Oe(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}D(Oe,"escapeRegExp");var br=Object.defineProperty,P=(e,t)=>br(e,"name",{value:t,configurable:!0});function Be(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Date}P(Be,"isComparable");var kt="abcdefghijklmnopqrstuvwxyz";function Ot(){return Array(8).fill(0).map(()=>kt[Math.floor(Math.random()*kt.length)]).join("")}P(Ot,"randomId");function He(e){return e instanceof RegExp?e:new RegExp(e)}P(He,"makeRegExp");function je(e){return e&&Object.keys(e).some(t=>t.startsWith("$"))}P(je,"isEvalExpr");var wr=Symbol("expr"),en=Symbol("type"),O=P((e,t)=>g({["$"+e]:t},wr,!0),"Eval"),re={};re.$=Ce;function ne(e,t){return re[`$${e}`]=t,r=>O(e,r)}P(ne,"unary");function B(e,t){return re[`$${e}`]=t,(...r)=>O(e,r)}P(B,"multary");function ie(e,t){return re[`$${e}`]=(r,n)=>{let i=j(n,r[0]),s=j(n,r[1]);return I(i)||I(s)?!0:t(i.valueOf(),s.valueOf())},(...r)=>O(e,r)}P(ie,"comparator");O.switch=(e,t)=>O("switch",{branches:e,default:t});re.$switch=(e,t)=>{for(let r of e.branches)if(j(t,r.case))return j(t,r.then);return j(t,e.default)};O.if=B("if",([e,t,r],n)=>j(n,e)?j(n,t):j(n,r));O.ifNull=B("ifNull",([e,t],r)=>j(r,e)??j(r,t));O.add=B("add",(e,t)=>e.reduce((r,n)=>r+j(t,n),0));O.multiply=B("multiply",(e,t)=>e.reduce((r,n)=>r*j(t,n),1));O.subtract=B("subtract",([e,t],r)=>j(r,e)-j(r,t));O.divide=B("divide",([e,t],r)=>j(r,e)/j(r,t));O.eq=ie("eq",(e,t)=>e===t);O.ne=ie("ne",(e,t)=>e!==t);O.gt=ie("gt",(e,t)=>e>t);O.gte=ie("gte",(e,t)=>e>=t);O.lt=ie("lt",(e,t)=>e<t);O.lte=ie("lte",(e,t)=>e<=t);O.in=B("in",([e,t],r)=>t.includes(j(r,e)));O.nin=B("nin",([e,t],r)=>!t.includes(j(r,e)));O.concat=B("concat",(e,t)=>e.map(r=>j(t,r)).join(""));O.regex=B("regex",([e,t],r)=>He(j(r,t)).test(j(r,e)));O.and=B("and",(e,t)=>e.every(r=>j(t,r)));O.or=B("or",(e,t)=>e.some(r=>j(t,r)));O.not=ne("not",(e,t)=>!j(t,e));O.sum=ne("sum",(e,t)=>t.reduce((r,n)=>r+le(e,n),0));O.avg=ne("avg",(e,t)=>t.reduce((r,n)=>r+le(e,n),0)/t.length);O.max=ne("max",(e,t)=>Math.max(...t.map(r=>le(e,r))));O.min=ne("min",(e,t)=>Math.min(...t.map(r=>le(e,r))));O.count=ne("count",(e,t)=>new Set(t.map(r=>le(e,r))).size);function Ce(e,t){if(typeof e=="string")return Ce(["_",e],t);let[r,n]=e,i=t[r];if(!i)return i;if(n in i)return i[n];let s=Object.keys(i).find(a=>n.startsWith(a+"."))||n.split(".",1)[0],o=n.slice(s.length+1).split(".").filter(Boolean);o.unshift(s);for(let a of o)if(i=i[a],!i)return i;return i}P(Ce,"getRecursive");function Qe(e,t){for(let r in e)if(r in re)return re[r](e[r],t);return e}P(Qe,"executeEvalExpr");function le(e,t){return typeof e=="string"?Ce(e,t):Qe(e,t)}P(le,"executeAggr");function j(e,t){return Be(t)||I(t)?t:Qe(t,e)}P(j,"executeEval");function vr(e,t,r){for(let n in t){let i=e,s=n.split("."),o=s.pop();for(let a of s)i=i[a]||={};i[o]=j({[r]:e,_:e},t[n])}return e}P(vr,"executeUpdate");var Le;(e=>{e.number=["integer","unsigned","float","double","decimal"],e.string=["char","string","text"],e.boolean=["boolean"],e.date=["timestamp","date","time"],e.object=["list","json"];let t=/^(\w+)(?:\((.+)\))?$/;function r(n){if(typeof n=="function")return{type:"expr",expr:n};if(typeof n!="string")return{initial:null,...n};let i=t.exec(n);if(!i)throw new TypeError("invalid field definition");let s=i[1],o=(i[2]||"").split(","),a={type:s};return a.initial===void 0&&(e.number.includes(a.type)&&(a.initial=0),e.string.includes(a.type)&&(a.initial=""),a.type==="list"&&(a.initial=[]),a.type==="json"&&(a.initial={})),s==="decimal"?(a.precision=+o[0],a.scale=+o[1]):o[0]&&(a.length=+o[0]),a}e.parse=r,P(r,"parse")})(Le||(Le={}));var Se=class{constructor(e){this.name=e,this.autoInc=!1,this.primary="id",this.unique=[],this.foreign={}}fields={};extend(e={},t={}){let{primary:r,autoInc:n,unique:i=[],foreign:s}=t;this.primary=r||this.primary,this.autoInc=n||this.autoInc,this.unique.push(...i),Object.assign(this.foreign,s);for(let o in e)this.fields[o]=Le.parse(e[o]);this.checkIndex(this.primary),this.unique.forEach(o=>this.checkIndex(o))}checkIndex(e){for(let t of K(e))if(!this.fields[t])throw new TypeError(`missing field definition for index key "${t}"`)}resolveValue(e,t){if(I(t))return t;if(this.fields[e]?.type==="time"){let r=new Date(0);return r.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),r}return t}format(e,t=!0,r="",n={}){let i=Object.keys(this.fields);return Object.entries(e).map(([s,o])=>{if(s=r+s,i.includes(s))n[s]=o;else if(!o||typeof o!="object"||je(o)){if(i.find(c=>s.startsWith(c+".")))n[s]=o;else if(t)throw new TypeError(`unknown field "${s}" in model ${this.name}`)}else this.format(o,t,s+".",n)}),n}parse(e){let t={};for(let r in e){let n=t,i=r.split(".").reverse(),s="";for(let o=i.length-1;o>0;o--){let a=i[o];s+=a+".",n=n[a]??={}}if(r in e){let o=this.resolveValue(r,e[r]);n[i[0]]=o}}return t}create(e){let t={},r=K(this.primary);for(let n in this.fields){let{initial:i}=this.fields[n];!r.includes(n)&&!I(i)&&(t[n]=pe(i))}return this.parse({...t,...e})}};P(Se,"Model");var Ue=P((e,t={},r="")=>new Proxy(t,{get(n,i){return typeof i=="symbol"||i in n||i.startsWith("$")?Reflect.get(n,i):Ue(e,O("",[e,`${r}${i}`]),`${r}${i}.`)}}),"createRow"),We=class{row;model;driver;constructor(e,t){Object.assign(this,t);let r={};if(typeof t.table!="string"&&!(t.table instanceof Y))for(let n in t.table)r[n]=Ue(n);g(this,"driver",e),g(this,"row",Ue(this.ref,r)),g(this,"model",e.model(this.table))}resolveQuery(e={}){if(typeof e=="function")return{$expr:e(this.row)};if(Array.isArray(e)||e instanceof RegExp||["string","number"].includes(typeof e)){let{primary:t}=this.model;if(Array.isArray(t))throw new TypeError("invalid shorthand for composite primary key");return{[t]:e}}return e}resolveField(e){if(typeof e=="string")return this.row[e];if(typeof e=="function")return e(this.row);throw new TypeError("invalid field definition")}resolveFields(e){if(typeof e=="string"&&(e=[e]),Array.isArray(e)){let t=Object.keys(this.model.fields),r=e.flatMap(n=>this.model.fields[n]?n:t.filter(i=>i.startsWith(n+".")));return Object.fromEntries(r.map(n=>[n,this.row[n]]))}else return ae(e,t=>this.resolveField(t))}execute(){return this.driver[this.type](this,...this.args)}};P(We,"Executable");var Y=class extends We{tables={};constructor(e,t,r){super(e,{type:"get",ref:Ot(),table:t,query:null,args:[{sort:[],limit:1/0,offset:0,group:[],having:O.and(),optional:{}}]}),this.tables[this.ref]=this.model,this.query=this.resolveQuery(r),typeof t!="string"&&Object.assign(this.tables,t.tables)}where(e){return this.query.$and||=[],this.query.$and.push(this.resolveQuery(e)),this}limit(...e){return e.length>1&&this.offset(e.shift()),this.args[0].limit=e[0],this}offset(e){return this.args[0].offset=e,this}orderBy(e,t="asc"){return this.args[0].sort.push([this.resolveField(e),t]),this}groupBy(e,...t){this.args[0].fields=this.resolveFields(e),this.args[0].group=Object.keys(this.args[0].fields);let r=typeof t[0]=="function"?void 0:t.shift();return Object.assign(this.args[0].fields,this.resolveFields(r||{})),t[0]&&this.having(t[0]),new Y(this.driver,this)}having(e){return this.args[0].having.$and.push(this.resolveField(e)),this}project(e){return this.args[0].fields=this.resolveFields(e),new Y(this.driver,this)}_action(e,...t){return new We(this.driver,{...this,type:e,args:t})}evaluate(e){return new Y(this.driver,this)._action("eval",this.resolveField(e))}execute(e){return e?this.evaluate(e).execute():super.execute()}};P(Y,"Selection");function _r(e,t,r){let{limit:n,offset:i,sort:s}=t;return e.sort((o,a)=>{for(let[c,d]of s){let b=d==="asc"?1:-1,w=j({[r]:o,_:o},c),k=j({[r]:a,_:a},c);if(w<k)return-b;if(w>k)return b}return 0}),e.slice(i,i+n)}P(_r,"executeSort");var Ae=class{tables=Object.create(null);drivers=Object.create(null);tasks=Object.create(null);stashed=new Set;refresh(){for(let e in this.tables)this.tasks[e]=this.prepare(e)}getDriver(e){return Object.values(this.drivers)[0]}async prepare(e){return this.stashed.add(e),await this.tasks[e],new Promise(async t=>{Promise.resolve().then(async()=>{this.stashed.delete(e)&&await this.getDriver(e)?.prepare(e),t()})})}extend(e,t,r={}){let n=this.tables[e];n||(n=this.tables[e]=new Se(e)),n.extend(t,r),this.tasks[e]=this.prepare(e)}select(e,t){return new Y(this.getDriver(e),e,t)}join(e,t,r){if(Array.isArray(e)){let n=new Y(this.getDriver(e[0]),Object.fromEntries(e.map(i=>[i,i])));return typeof t=="function"&&(n.args[0].having=O.and(t(...e.map(i=>n.row[i])))),n.args[0].optional=Object.fromEntries(e.map((i,s)=>[i,r?.[s]])),n}else{let n=new Y(this.getDriver(e[0]),e);return typeof t=="function"&&(n.args[0].having=O.and(t(n.row))),n.args[0].optional=r,n}}async get(e,t,r){await this.tasks[e],Array.isArray(r)?r={fields:r}:r||(r={});let n=this.select(e,t);if(r.fields&&n.project(r.fields),r.limit!==void 0&&n.limit(r.limit),r.offset!==void 0&&n.offset(r.offset),r.sort)for(let i in r.sort)n.orderBy(i,r.sort[i]);return n.execute()}async eval(e,t,r){return await this.tasks[e],this.select(e,r).execute(typeof t=="function"?t:()=>t)}async set(e,t,r){await this.tasks[e];let n=this.select(e,t);if(typeof r=="function"&&(r=r(n.row)),K(n.model.primary).some(s=>s in r))throw new TypeError("cannot modify primary key");await n._action("set",n.model.format(r)).execute()}async remove(e,t){await this.tasks[e],await this.select(e,t)._action("remove").execute()}async create(e,t){await this.tasks[e];let r=this.select(e);return r._action("create",r.model.create(t)).execute()}async upsert(e,t,r){await this.tasks[e];let n=this.select(e);typeof t=="function"&&(t=t(n.row)),t=t.map(i=>n.model.format(i)),r=K(r||n.model.primary),await n._action("upsert",t,r).execute()}async stopAll(){let e=Object.values(this.drivers);this.drivers=Object.create(null),await Promise.all(e.map(t=>t.stop()))}async drop(e){await this.getDriver(e).drop(e)}async dropAll(){await Promise.all(Object.values(this.drivers).map(e=>e.drop()))}async stats(){let e={size:0,tables:{}};return await Promise.all(Object.values(this.drivers).map(async t=>{let{size:r=0,tables:n}=await t.stats();e.size+=r,Object.assign(e.tables,n)})),e}};P(Ae,"Database");var xr=class{constructor(e){this.database=e}model(e){if(typeof e=="string"){let r=this.database.tables[e];if(r)return r;throw new TypeError(`unknown table name "${e}"`)}if(e instanceof Y){if(!e.args[0].fields)return e.model;let r=new Se("temp");return r.fields=ae(e.args[0].fields,(n,i)=>({type:"expr"})),r}let t=new Se("temp");for(let r in e){let n=this.model(e[r]);for(let i in n.fields)t.fields[`${r}.${i}`]={type:"expr",expr:{$:[r,i]}}}return t}};P(xr,"Driver");var Et=class extends Error{constructor(e,t){super(t||e.replace("-"," ")),this.code=e}name="RuntimeError";static check(e,t){return e instanceof Et?!t||e.message===t:!1}};P(Et,"RuntimeError");var $t={$or:(e,t)=>e.reduce((r,n)=>r||ce(n,t),!1),$and:(e,t)=>e.reduce((r,n)=>r&&ce(n,t),!0),$not:(e,t)=>!ce(e,t),$exists:(e,t)=>e!==I(t),$eq:(e,t)=>t.valueOf()===e.valueOf(),$ne:(e,t)=>t.valueOf()!==e.valueOf(),$gt:(e,t)=>t.valueOf()>e.valueOf(),$gte:(e,t)=>t.valueOf()>=e.valueOf(),$lt:(e,t)=>t.valueOf()<e.valueOf(),$lte:(e,t)=>t.valueOf()<=e.valueOf(),$in:(e,t)=>e.includes(t),$nin:(e,t)=>!e.includes(t),$regex:(e,t)=>He(e).test(t),$regexFor:(e,t)=>new RegExp(t,"i").test(e),$bitsAllSet:(e,t)=>(e&t)===e,$bitsAllClear:(e,t)=>(e&t)===0,$bitsAnySet:(e,t)=>(e&t)!==0,$bitsAnyClear:(e,t)=>(e&t)!==e,$el:(e,t)=>t.some(r=>ce(e,r)),$size:(e,t)=>t.length===e};function ce(e,t){if(Array.isArray(e))return e.includes(t);if(e instanceof RegExp)return e.test(t);if(Be(e))return t.valueOf()===e.valueOf();if(I(e))return I(t);for(let r in e)if(r in $t&&!$t[r](e[r],t))return!1;return!0}P(ce,"executeFieldQuery");function Ee(e,t,r){return Object.entries(t).every(([i,s])=>{if(i==="$and")return s.reduce((o,a)=>o&&Ee(e,a,r),!0);if(i==="$or")return s.reduce((o,a)=>o||Ee(e,a,r),!1);if(i==="$not")return!Ee(e,s,r);if(i==="$expr")return j({[r]:e,_:e},s);try{return ce(s,e[i])}catch{return!1}})}P(Ee,"executeQuery");export*from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Bot as ft}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Context as se,Schema as M}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";var St=Object.defineProperty,kr=(e,t,r)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,T=(e,t)=>St(e,"name",{value:t,configurable:!0}),X=(e,t,r)=>(kr(e,typeof t!="symbol"?t+"":t,r),r);function Ke(e){return e!==null&&e!==!1&&e!==void 0}T(Ke,"isBailed");var Xe=class{constructor(e){this.root=e,g(this,E.current,e),g(this.on("internal/hook",function(t,r,n){let i=n?"unshift":"push",{scope:s}=this[E.current],{runtime:o,disposables:a}=s;if(t==="ready"&&this.isActive)s.ensure(async()=>r());else{if(t==="dispose")return a[i](r),g(r,"name","event <dispose>"),()=>R(a,r);if(t==="fork")return o.forkables[i](r),s.collect("event <fork>",()=>R(o.forkables,r))}}),E.static,e.scope)}isActive=!1;_tasks=new Set;_hooks={};queue(e){this[E.current].scope.ensure(async()=>e)}async flush(){for(;this._tasks.size;)await Promise.all(Array.from(this._tasks))}*getHooks(e,t){let r=this._hooks[e]||[];for(let[n,i]of r.slice()){let s=t?.[E.filter];s&&!s.call(t,n)||(yield i)}}async parallel(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();await Promise.all([...this.getHooks(r,t)].map(async n=>{await n.apply(t,e)}))}emit(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.getHooks(r,t))n.apply(t,e)}async serial(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.getHooks(r,t)){let i=await n.apply(t,e);if(Ke(i))return i}}bail(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.getHooks(r,t)){let i=n.apply(t,e);if(Ke(i))return i}}register(e,t,r,n){let i=this.root.config.maxListeners;t.length>=i&&this.root.emit("internal/warning",`max listener count (${i}) for ${e} exceeded, which may be caused by a memory leak`);let s=this[E.current];return t[n?"unshift":"push"]([s,r]),s.state.collect(e,()=>this.unregister(t,r))}unregister(e,t){let r=e.findIndex(([n,i])=>i===t);if(r>=0)return e.splice(r,1),!0}on(e,t,r=!1){let n=this.bail(this,"internal/hook",e,t,r);if(n)return n;let i=this._hooks[e]||=[],s=typeof e=="string"?`event <${e}>`:"event (Symbol)";return this.register(s,i,t,r)}once(e,t,r=!1){let n=this.on(e,function(...i){return n(),t.apply(this,i)},r);return n}off(e,t){return this.unregister(this._hooks[e]||[],t)}async start(){this.isActive=!0;let e=this._hooks.ready||[];for(;e.length;){let[t,r]=e.shift();t.scope.ensure(async()=>r())}await this.flush()}async stop(){this.isActive=!1,this.root.scope.reset()}};T(Xe,"Lifecycle");X(Xe,"methods",["on","once","off","before","after","parallel","emit","serial","bail","start","stop"]);function Ge(e){return!(!e.prototype||e.prototype.constructor!==e)}T(Ge,"isConstructor");function Pe(e){return Object.getPrototypeOf(e).constructor}T(Pe,"getConstructor");function ue(e,t){if(t===!1)return;t===!0&&(t=void 0),t??={};let r=e.Config||e.schema;return r&&e.schema!==!1&&(t=r(t)),t}T(ue,"resolveConfig");var Ye=class{constructor(e,t){this.parent=e,this.config=t,this.uid=e.registry?e.registry.counter:0,this.ctx=this.context=e.extend({scope:this}),this.proxy=new Proxy({},{get:(r,n)=>Reflect.get(this.config,n)})}uid;ctx;disposables=[];error;status="pending";proxy;context;acceptors=[];tasks=new Set;hasError=!1;get _config(){return this.runtime.isReactive?this.proxy:this.config}collect(e,t){let r=g(()=>(R(this.disposables,r),t()),"name",e);return this.disposables.push(r),r}restart(){this.reset(),this.start()}_getStatus(){return this.uid===null?"disposed":this.hasError?"failed":this.tasks.size?"loading":this.ready?"active":"pending"}_updateStatus(e){let t=this.status;e?.(),this.status=this._getStatus(),t!==this.status&&this.context.emit("internal/status",this,t)}ensure(e){let t=e().catch(r=>{this.context.emit("internal/warning",r),this.cancel(r)}).finally(()=>{this._updateStatus(()=>this.tasks.delete(t)),this.context.events._tasks.delete(t)});this._updateStatus(()=>this.tasks.add(t)),this.context.events._tasks.add(t)}cancel(e){this.error=e,this._updateStatus(()=>this.hasError=!0),this.reset()}setup(){this.runtime.using.length&&(g(this.context.on("internal/before-service",e=>{this.runtime.using.includes(e)&&(this._updateStatus(),this.reset())}),E.static,this),g(this.context.on("internal/service",e=>{this.runtime.using.includes(e)&&this.start()}),E.static,this))}get ready(){return this.runtime.using.every(e=>this.ctx[e])}reset(){this.disposables=this.disposables.splice(0,1/0).filter(e=>{if(this.uid!==null&&e[E.static]===this)return!0;e()})}accept(...e){let t=Array.isArray(e[0])?e.shift():null,r={keys:t,callback:e[0],...e[1]};return this.acceptors.push(r),r.immediate&&r.callback?.(this.config),this.collect(`accept <${t?.join(", ")||"*"}>`,()=>R(this.acceptors,r))}decline(e){return this.accept(e,()=>!0)}checkUpdate(e,t){if(t)return[!0,!0];if(t===!1)return[!1,!1];let r=Object.create(null),n=T(c=>{let d=r[c]??=!de(this.config[c],e[c]);return s||=d,d},"checkPropertyUpdate"),i=new Set,s=!1,o=!1,a=this.runtime.isReactive||null;for(let{keys:c,callback:d,passive:b}of this.acceptors){if(!c)a||=!b;else if(b)c?.forEach(k=>i.add(k));else{let k=!1;for(let m of c)k||=n(m);if(!k)continue}d?.(e)&&(o=!0)}for(let c in{...this.config,...e})if(a!==!1&&!(c in r)&&!i.has(c)){let d=n(c);a===null&&(o||=d)}return[s,o]}};T(Ye,"EffectScope");var jt=class extends Ye{constructor(e,t,r){super(e,t),this.runtime=r,this.dispose=g(e.scope.collect(`fork <${e.runtime.name}>`,()=>{this.uid=null,this.reset();let n=R(r.disposables,this.dispose);return R(r.children,this)&&!r.children.length&&e.registry.delete(r.plugin),this.context.emit("internal/fork",this),n}),E.static,r),r.children.push(this),r.disposables.push(this.dispose),this.context.emit("internal/fork",this),r.isReusable&&this.setup(),this.start()}dispose;start(){if(this.ready){this._updateStatus(()=>this.hasError=!1);for(let e of this.runtime.forkables)this.ensure(async()=>e(this.context,this._config))}}update(e,t){let r=this.config,n=this.runtime.isForkable?this:this.runtime;if(n.config!==r)return;let i=ue(this.runtime.plugin,e),[s,o]=n.checkUpdate(i,t);this.context.emit("internal/before-update",this,e),this.config=i,n.config=i,s&&this.context.emit("internal/update",this,r),o&&n.restart()}};T(jt,"ForkScope");var Ve=class extends Ye{constructor(e,t,r){super(e[E.current],r),this.plugin=t,e.set(t,this),t&&this.setup()}runtime=this;schema;using=[];forkables=[];children=[];isReusable=!1;isReactive=!1;get isForkable(){return this.forkables.length>0}get name(){if(!this.plugin)return"root";let{name:e}=this.plugin;return!e||e==="apply"?"anonymous":e}fork(e,t){return new jt(e,t,this)}dispose(){return this.uid=null,this.reset(),this.context.emit("internal/runtime",this),!0}setup(){this.schema=this.plugin.Config||this.plugin.schema,this.using=this.plugin.using||[],this.isReusable=this.plugin.reusable,this.isReactive=this.plugin.reactive,this.context.emit("internal/runtime",this),this.isReusable?this.forkables.push(this.apply):super.setup(),this.restart()}apply=(e,t)=>{let r=this.plugin;if(typeof r!="function")this.ensure(async()=>r.apply(e,t));else if(Ge(r)){let n=new r(e,t),i=n[E.immediate];i&&(e[i]=n),n.fork&&this.forkables.push(n.fork.bind(n))}else this.ensure(async()=>r(e,t))};reset(){super.reset();for(let e of this.children)e.reset()}start(){if(this.ready){this._updateStatus(()=>this.hasError=!1),!this.isReusable&&this.plugin&&this.apply(this.context,this._config);for(let e of this.children)e.start()}}update(e,t){this.isForkable&&this.context.emit("internal/warning",`attempting to update forkable plugin "${this.plugin.name}", which may lead to unexpected behavior`);let r=this.config,n=ue(this.runtime.plugin||Pe(this.context),e),[i,s]=this.checkUpdate(n,t),o=this.children.find(a=>a.config===r);this.config=n,o&&(this.context.emit("internal/before-update",o,e),o.config=n,i&&this.context.emit("internal/update",o,r)),s&&this.restart()}};T(Ve,"MainScope");function Ct(e){return e&&typeof e=="object"&&typeof e.apply=="function"}T(Ct,"isApplicable");var Je=class extends Map{constructor(e,t){super(),this.root=e,g(this,E.current,e),e.scope=new Ve(this,null,t),e.scope.runtime.isReactive=!0}_counter=0;get counter(){return++this._counter}resolve(e){return e&&(typeof e=="function"?e:e.apply)}get(e){return super.get(this.resolve(e))}has(e){return super.has(this.resolve(e))}set(e,t){return super.set(this.resolve(e),t)}delete(e){e=this.resolve(e);let t=this.get(e);return t?(super.delete(e),t.dispose()):!1}using(e,t){return this.plugin({using:e,apply:t,name:t.name})}plugin(e,t){if(typeof e!="function"&&!Ct(e))throw new Error('invalid plugin, expect function or object with an "apply" method');if(t=ue(e,t),!t)return;let r=this[E.current],n=this.get(e);return n?(n.isForkable||this.root.emit("internal/warning",`duplicate plugin detected: ${e.name}`),n.fork(r,t)):(n=new Ve(this,e,t),n.fork(r,t))}dispose(e){return this.delete(e)}};T(Je,"Registry");X(Je,"methods",["using","plugin","dispose"]);var At=class{constructor(e){let t=ue(Pe(this),e),r=T(n=>{if(n){r(Object.getPrototypeOf(n));for(let i of Object.getOwnPropertySymbols(n))this[i]=new n[i](this,t)}},"attach");this.root=this,this.mapping=Object.create(null),r(this[At.internal])}[Symbol.for("nodejs.util.inspect.custom")](){return`Context <${this.runtime.name}>`}get events(){return this.lifecycle}get state(){return this.scope}extend(e={}){return Object.assign(Object.create(this),e)}isolate(e){let t=Object.create(this.mapping);for(let r of e)t[r]=Symbol(r);return this.extend({mapping:t})}},E=At;T(E,"Context");X(E,"config",Symbol("config"));X(E,"events",Symbol("events"));X(E,"static",Symbol("static"));X(E,"filter",Symbol("filter"));X(E,"source",Symbol("source"));X(E,"current",Symbol("current"));X(E,"internal",Symbol("internal"));X(E,"immediate",Symbol("immediate"));(e=>{function t(i,s){for(let o of s.methods||[])g(e.prototype,o,function(...a){return this[i][o](...a)});for(let o of s.properties||[])Object.defineProperty(e.prototype,o,{configurable:!0,get(){return this[i][o]},set(a){this[i][o]=a}})}e.mixin=t,T(t,"mixin");function r(i,s={}){let o=typeof i=="symbol"?i:Symbol(i);if(Object.defineProperty(this.prototype,i,{configurable:!0,get(){let a=this.mapping[i]||o,c=this.root[a];if(c)return g(c,e.current,this),c},set(a){let c=this.mapping[i]||o,d=this.root[c];if(d===a)return;let b=Object.create(null);if(b[e.filter]=w=>this.mapping[i]===w.mapping[i],a&&d&&typeof i=="string")throw new Error(`service ${i} has been registered`);typeof i=="string"&&this.emit(b,"internal/before-service",i,a),this.root[c]=a,a&&typeof a=="object"&&g(a,e.source,this),typeof i=="string"&&this.emit(b,"internal/service",i,d)}}),Ge(s)){let a=n(this.prototype);a[o]=s}t(i,s)}e.service=r,T(r,"service");function n(i){if(Object.prototype.hasOwnProperty.call(i,e.internal))return i[e.internal];let s=n(Object.getPrototypeOf(i));return i[e.internal]=Object.create(s)}T(n,"ensureInternal")})(E||(E={}));E.prototype[E.internal]=Object.create(null);E.service("registry",Je);E.service("lifecycle",Xe);E.mixin("state",{properties:["config","runtime"],methods:["collect","accept","decline"]});var Ze=class{constructor(e,t,r){this.ctx=e,Pe(e.root).service(t),g(this,E.current,e),r&&(this[E.immediate]=t),e.on("ready",async()=>{await Promise.resolve(),await this.start(),e[t]=this}),e.on("dispose",async()=>{e[t]=null,await this.stop()})}start(){}stop(){}get caller(){return this[E.current]}};T(Ze,"Service");import{Context as ht}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Context as ot,Schema as _e}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";var J=new Uint32Array(65536),Or=(e,t)=>{let r=e.length,n=t.length,i=1<<r-1,s=-1,o=0,a=r,c=r;for(;c--;)J[e.charCodeAt(c)]|=1<<c;for(c=0;c<n;c++){let d=J[t.charCodeAt(c)],b=d|o;d|=(d&s)+s^s,o|=~(d|s),s&=d,o&i&&a++,s&i&&a--,o=o<<1|1,s=s<<1|~(b|o),o&=b}for(c=r;c--;)J[e.charCodeAt(c)]=0;return a},Er=(e,t)=>{let r=t.length,n=e.length,i=[],s=[],o=Math.ceil(r/32),a=Math.ceil(n/32);for(let h=0;h<o;h++)s[h]=-1,i[h]=0;let c=0;for(;c<a-1;c++){let h=0,_=-1,U=c*32,H=Math.min(32,n)+U;for(let u=U;u<H;u++)J[e.charCodeAt(u)]|=1<<u;for(let u=0;u<r;u++){let l=J[t.charCodeAt(u)],f=s[u/32|0]>>>u&1,p=i[u/32|0]>>>u&1,y=l|h,C=((l|p)&_)+_^_|l|p,v=h|~(C|_),S=_&C;v>>>31^f&&(s[u/32|0]^=1<<u),S>>>31^p&&(i[u/32|0]^=1<<u),v=v<<1|f,S=S<<1|p,_=S|~(y|v),h=v&y}for(let u=U;u<H;u++)J[e.charCodeAt(u)]=0}let d=0,b=-1,w=c*32,k=Math.min(32,n-w)+w;for(let h=w;h<k;h++)J[e.charCodeAt(h)]|=1<<h;let m=n;for(let h=0;h<r;h++){let _=J[t.charCodeAt(h)],U=s[h/32|0]>>>h&1,H=i[h/32|0]>>>h&1,u=_|d,l=((_|H)&b)+b^b|_|H,f=d|~(l|b),p=b&l;m+=f>>>n-1&1,m-=p>>>n-1&1,f>>>31^U&&(s[h/32|0]^=1<<h),p>>>31^H&&(i[h/32|0]^=1<<h),f=f<<1|U,p=p<<1|H,b=p|~(u|f),d=f&u}for(let h=w;h<k;h++)J[e.charCodeAt(h)]=0;return m},Pt=(e,t)=>{if(e.length<t.length){let r=t;t=e,e=r}return t.length===0?e.length:e.length<=32?Or(e,t):Er(e,t)};import{Context as Rt,Logger as Cr,segment as Ar}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Context as at,segment as et}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Context as Rr}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Context as Fr,Logger as Nr,segment as Mt,Session as Nt}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Context as lt,h as Tr}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{Logger as qr,Schema as fe}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";import{segment as ve}from"https://registry.koishi.chat/modules/@satorijs/core/index.js";var zt=Object.defineProperty,Sr=(e,t,r)=>t in e?zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x=(e,t)=>zt(e,"name",{value:t,configurable:!0}),ee=(e,t,r)=>(Sr(e,typeof t!="symbol"?t+"":t,r),r);g(ft,"filter",!1);ft.prototype.getGuildMemberMap=x(async function(t){let r=await this.getGuildMemberList(t);return Object.fromEntries(r.map(n=>[n.userId,n.nickname||n.username]))},"getGuildMemberMap");ft.prototype.broadcast=x(async function(t,r,n=this.ctx.root.config.delay.broadcast){let i=[];for(let s=0;s<t.length;s++){s&&n&&await Fe(n);try{let o=t[s];i.push(...typeof o=="string"?await this.sendMessage(o,r):Array.isArray(o)?await this.sendMessage(o[0],r,o[1]):await this.sendMessage(o.channelId,r,o.guildId,{session:o}))}catch(o){this.ctx.logger("bot").warn(o)}}return i},"broadcast");var In=Ze;g(se.Config,"Basic",M.object({locale:M.string().default("zh").description("默认使用的语言。"),prefix:M.union([M.array(String).role("table"),M.transform(String,e=>[e]),M.any().hidden()]).role("computed").default([""]).description("指令前缀字符构成的数组。将被用于指令的匹配。"),nickname:M.union([M.array(String).role("table"),M.transform(String,e=>[e])]).description("机器人昵称构成的数组。将被用于指令的匹配。"),autoAssign:M.union([Boolean,Function]).default(!0).description("当获取不到频道数据时，是否使用接受者作为代理者。"),autoAuthorize:M.union([M.natural(),Function]).default(1).description("当获取不到用户数据时默认使用的权限等级。"),minSimilarity:M.percent().default(.64).description("用于模糊匹配的相似系数，应该是一个 0 到 1 之间的数值。数值越高，模糊匹配越严格。设置为 1 可以完全禁用模糊匹配。")}).description("基础设置"));g(se.Config,"Message",M.object({delay:M.object({character:M.natural().role("ms").default(0).description("调用 `session.sendQueued()` 时消息间发送的最小延迟，按前一条消息的字数计算。"),message:M.natural().role("ms").default(.1*Q.second).description("调用 `session.sendQueued()` 时消息间发送的最小延迟，按固定值计算。"),cancel:M.natural().role("ms").default(0).description("调用 `session.cancelQueued()` 时默认的延迟。"),broadcast:M.natural().role("ms").default(.5*Q.second).description("调用 `bot.broadcast()` 时默认的延迟。"),prompt:M.natural().role("ms").default(Q.minute).description("调用 `session.prompt()` 时默认的等待时间。")})}).description("消息设置"));g(se.Config,"Advanced",M.object({maxListeners:M.natural().default(64).description("每种监听器的最大数量。如果超过这个数量，Koishi 会认定为发生了内存泄漏，将产生一个警告。")}).description("高级设置"));se.Config.list.push(se.Config.Basic,se.Config.Message,se.Config.Advanced);function jr(e){return e}x(jr,"defineConfig");var it;(e=>{let t;(r=>{r[r.ignore=1]="ignore"})(t=e.Flag||(e.Flag={})),e.fields=[]})(it||(it={}));var st;(e=>{let t;(r=>{r[r.ignore=1]="ignore",r[r.silent=4]="silent"})(t=e.Flag||(e.Flag={})),e.fields=[]})(st||(st={}));var Me=class extends Ae{constructor(e){super(),this.app=e,g(this,ht.current,e),this.extend("user",{id:"unsigned(20)",name:{type:"string",length:63},flag:"unsigned(20)",authority:"unsigned(4)",locale:"string(63)"},{autoInc:!0}),this.extend("channel",{id:"string(63)",platform:"string(63)",flag:"unsigned(20)",assignee:"string(63)",guildId:"string(63)",locale:"string(63)"},{primary:["id","platform"]}),e.on("bot-added",t=>{t.platform in this.tables.user.fields||this.extend("user",{[t.platform]:{type:"string",length:63}},{unique:[t.platform]})})}async getUser(e,t,r){let n=await this.get("user",{[e]:t},r);return Array.isArray(t)?n:(n[0]&&Object.assign(n[0],{[e]:t}),n[0])}setUser(e,t,r){return this.set("user",{[e]:t},r)}createUser(e,t,r){return this.create("user",{[e]:t,...r})}async getChannel(e,t,r){let n=await this.get("channel",{platform:e,id:t},r);return Array.isArray(t)?n:(n[0]&&Object.assign(n[0],{platform:e,id:t}),n[0])}getSelfIds(e,t){if(e)return t||=this.app.bots.filter(n=>n.platform===e).map(n=>n.selfId),{[e]:t};let r={};for(let n of this.app.bots)(r[n.platform]||=[]).push(n.selfId);return r}async getAssignedChannels(e,t=this.getSelfIds()){return this.get("channel",{$or:Object.entries(t).map(([r,n])=>({platform:r,assignee:n}))},e)}setChannel(e,t,r){return this.set("channel",{platform:e,id:t},r)}createChannel(e,t,r){return this.create("channel",{platform:e,id:t,...r})}async broadcast(...e){let t;Array.isArray(e[0])&&(t=e.shift());let[r,n]=e;if(!r)return[];let i=await this.getAssignedChannels(["id","assignee","flag","platform","guildId","locale"]),s={};for(let o of i){let{platform:a,id:c,assignee:d,flag:b}=o;t&&!t.includes(`${a}:${c}`)||!n&&b&4||((s[a]||={})[d]||=[]).push(o)}return(await Promise.all(this.app.bots.map(o=>{let a=s[o.platform]?.[o.selfId];if(!a)return Promise.resolve([]);let c=a.map(({id:d,guildId:b,locale:w})=>o.session({type:"message",subtype:"group",channelId:d,guildId:b,locale:w}));return o.broadcast(c,r)}))).flat(1)}};x(Me,"DatabaseService");ee(Me,"methods",["getSelfIds","broadcast"]);Me.prototype.extend=x(function(t,r,n){Ae.prototype.extend.call(this,t,r,{...n}),this.app.emit("model",t)},"extend");ht.service("database");ht.service("model",Me);var Rn=x((e,t,r)=>({name:e.name,reusable:!0,Config:t,filter:!1,apply(n,i){i={...i},r?.(n,i);let s=new e(n.model,i),o=n.mapping.database||"default";n.on("ready",async()=>{await s.start(),n.model.drivers[o]=s,n.model.refresh();let a=Object.create(n.model);n.database=a}),n.on("dispose",async()=>{n.database=null,delete n.model.drivers[o],await s.stop()})}}),"defineDriver");_e.filter=x(function(){return _e.any().role("filter")},"filter");_e.computed=x(function(t){return _e.union([t,_e.any().hidden()]).role("computed")},"computed");function te(e,t,...r){return e.intersect(n=>r.length?r.includes(n[t]):!!n[t])}x(te,"property");var pt=class{constructor(e){this.app=e,g(this,ot.current,e),e.filter=()=>!0,e.on("internal/runtime",t=>{t.uid&&(t.ctx.filter=r=>t.children.some(n=>n.ctx.filter(r)))})}get caller(){return this[ot.current]}any(){return this.caller.extend({filter:()=>!0})}never(){return this.caller.extend({filter:()=>!1})}union(e){let t=this.caller,r=typeof e=="function"?e:e.filter;return this.caller.extend({filter:n=>t.filter(n)||r(n)})}intersect(e){let t=this.caller,r=typeof e=="function"?e:e.filter;return this.caller.extend({filter:n=>t.filter(n)&&r(n)})}exclude(e){let t=this.caller,r=typeof e=="function"?e:e.filter;return this.caller.extend({filter:n=>t.filter(n)&&!r(n)})}user(...e){return te(this.caller,"userId",...e)}self(...e){return te(this.caller,"selfId",...e)}guild(...e){return te(this.caller,"guildId",...e)}channel(...e){return te(this.caller,"channelId",...e)}platform(...e){return te(this.caller,"platform",...e)}private(...e){return te(this.caller.exclude(te(this.caller,"guildId")),"userId",...e)}};x(pt,"FilterService");ee(pt,"methods",["any","never","union","intersect","exclude","user","self","guild","channel","platform","private"]);ot.service("$filter",pt);var Pr={general:{name:"中文",paren:"（{0}）",quote:"“{0}”",comma:"，",and:"和",or:"或",day:"天",hour:"小时",minute:"分钟",second:"秒"},internal:{"low-authority":"权限不足。","insufficient-arguments":"缺少参数，输入帮助以查看用法。","redunant-arguments":"存在多余参数，输入帮助以查看用法。","invalid-argument":"参数 {0} 输入无效，{1}","unknown-option":"存在未知选项 {0}，输入帮助以查看用法。","invalid-option":"选项 {0} 输入无效，{1}","check-syntax":"输入帮助以查看用法。","invalid-number":"请提供一个数字。","invalid-integer":"请提供一个整数。","invalid-posint":"请提供一个正整数。","invalid-natural":"请提供一个非负整数。","invalid-date":"请输入合法的时间。","invalid-user":"请指定正确的用户。","invalid-channel":"请指定正确的频道。","suggest-hint":"您要找的是不是{0}？","suggest-command":"发送句号以使用推测的指令。"}},Ir={general:{name:"English",paren:" ({0}) ",quote:'"{0}"',comma:", ",and:"and",or:"or",day:"day",hour:"hour",minute:"minute",second:"second"},internal:{"low-authority":"Low authority.","insufficient-arguments":"Insufficient arguments, type help to see usage.","redunant-arguments":"Redunant arguments, type help to see usage.","invalid-argument":"Invalid argument {0}, {1}","unknown-option":"Unknown option {0}, type help to see usage.","invalid-option":"Invalid option {0}, {1}","check-syntax":"Type help to see usage.","invalid-number":"Expect a number.","invalid-integer":"Expect an integer.","invalid-posint":"Expect a positive integer.","invalid-natural":"Expect a non-negative integer.","invalid-date":"Expect a valid date.","invalid-user":"Expect a valid user.","invalid-channel":"Expect a valid channel.","suggest-hint":"Do you mean {0}?","suggest-command":"Send a period to apply the suggestion."}},Mr={general:{name:"日本語",paren:"（{0}）",quote:"「{0}」",comma:"、",and:"と",or:"や",day:"日",hour:"時間",minute:"分",second:"秒"},internal:{"low-authority":"実行できる権限が付与されていません","insufficient-arguments":"パラメータが不足しています、「help」を送信して使い方を確認してください。","redunant-arguments":"パラメータ数が多すぎます、「help」を送信して使い方を確認してください。","invalid-argument":"無効なパラメータ「{0}」、{1}","unknown-option":"未知なオプション「{0}」、「help」を送信して使い方を確認してください。","invalid-option":"無効なオプション「{0}」、{1}","check-syntax":"「help」を送信して使い方を検索してください。","invalid-number":"数字を指定してください。","invalid-integer":"整数を指定してください。","invalid-posint":"正の整数を指定してください。","invalid-natural":"自然数を指定してください。","invalid-date":"日付を指定してください。","invalid-user":"ユーザー名を指定してください。","invalid-channel":"チャンネル名を指定してください。","suggest-hint":"「{0}」を実行したいですか？","suggest-command":"句点を送信してコマンドを実行します。"}},Dr={general:{name:"francais",paren:" ({0}) ",quote:'"{0}"',comma:", ",and:"et",or:"ou",day:"jour",hour:"heure",minute:"minute",second:"seconde"},internal:{"low-authority":"Droits insuffisants.","insufficient-arguments":`Arguments insuffisants, tapez "help" pour afficher l'aide`,"redunant-arguments":`Arguments redondants, tapez "help" pour afficher l'aide`,"invalid-argument":"Arguments {0} invalides, {1}","unknown-option":`Option {0} inconnue, tapez "help" pour afficher l'aide`,"invalid-option":"Option {0} invalide, {1}","check-syntax":`Tapez "help" pour afficher l'aide`,"invalid-number":"Entrez un nombre.","invalid-integer":"Entrez un entier.","invalid-posint":"Entrez un entier positif.","invalid-natural":"Entrez un entier non négatif.","invalid-date":"Entrez une date valide.","invalid-user":"Entrez un nom d'utilisateur valide.","invalid-channel":"Entrez un nom de canal valide.","suggest-hint":"Voulez-vous dire {0} ?","suggest-command":"Tapez un point pour appliquer la suggestion."}},zr={general:{name:"中文",paren:"（{0}）",quote:"「{0}」",comma:"，",and:"和",or:"或",day:"天",hour:"小時",minute:"分鐘",second:"秒"},internal:{"low-authority":"權限不足。","insufficient-arguments":"參數個數不足，輸入「help」檢視用法。","redunant-arguments":"參數個數冗餘，輸入「help」檢視用法。","invalid-argument":"參數 {0} 無效，{1}","unknown-option":"存在未知選項 {0}，輸入「help」檢視用法。","invalid-option":"選項 {0} 無效，{1}","check-syntax":"輸入「help」檢視用法。","invalid-number":"請輸入有效數字。","invalid-integer":"請輸入有效整數。","invalid-posint":"請輸入有效正整數。","invalid-natural":"請輸入有效非負整數。","invalid-date":"請輸入有效時間。","invalid-user":"請指定有效用戶。","invalid-channel":"請指定有效頻道。","suggest-hint":"你想輸入的是{0}嗎？","suggest-command":"發送句號可使用推測的指令。"}},Ie=new Cr("i18n"),It=Symbol("template"),Ft=class{constructor(e){this.ctx=e,this.define("",{"":""}),this.define("zh",Pr),this.define("en",Ir),this.define("ja",Mr),this.define("fr",Dr),this.define("zh-TW",zr),this.registerBuiltins()}_data={};_presets={};compare(e,t,r={}){let n=1-Pt(e,t)/e.length,i=r.minSimilarity??this.ctx.root.config.minSimilarity;return n>=i?n:0}set(e,t,r){if(t.includes("@")||typeof r=="string"){let n=this._data[e],[i,s]=t.slice(0,-1).split("@");s&&(r[It]=s,Ie.warn("preset is deprecated and will be removed in the future")),!I(n[i])&&!e.startsWith("$")&&Ie.warn("override",e,i),n[i]=r,this[Rt.current]?.on("dispose",()=>{delete n[i]})}else for(let n in r)this.set(e,t+n+".",r[n])}define(e,...t){this._data[e]||={},typeof t[0]=="string"?this.set(e,t[0]+".",t[1]):this.set(e,"",t[0]),this.ctx.emit("internal/i18n")}formatter(e,t){Ie.warn("formatter is deprecated and will be removed in the future")}preset(e,t){this._presets[e]=t}find(e,t,r={}){if(!t)return[];let n=[];e=e.replace(/\(([^)]+)\)/g,(o,a)=>(n.push(a),"([^.]+)"));let i=new RegExp(`^${e}$`),s=[];for(let o in this._data)for(let a in this._data[o]){let c=i.exec(a);if(!c)continue;let d=this._data[o][a];if(typeof d!="string")continue;let b=this.compare(d,t,r);if(!b)continue;let w={};for(let k=0;k<n.length;k++)w[n[k]]=c[k+1];s.push({locale:o,data:w,similarity:b})}return s}render(e,t,r){if(e!==void 0){if(typeof e!="string"){let n=e[It],i=this._presets[n];if(!i)throw new Error(`Preset "${n}" not found`);return i(e,t,r)}return Ar.parse(e,t).join("")}}text(e,t,r){let n=new Set;for(let i of e)i&&n.add(i);for(let i in this._data)i.startsWith("$")||n.add(i);for(let i of t)for(let s of n)for(let o of["$"+s,s]){let a=this._data[o]?.[i];if(a!==void 0)return this.render(a,r,s)}return Ie.warn("missing",t[0]),t[0]}registerBuiltins(){this.preset("plural",(e,t,r)=>{let n=t.length in e?t.length:e.length-1;return this.render(e[n],t,r)}),this.preset("random",(e,t,r)=>this.render(he.pick(e),t,r)),this.preset("list",(e,t,r)=>{let n=Object.entries(t).map(([i,s])=>this.render(e.item,{key:i,value:s},r));return n.unshift(this.render(e.header,t,r)),n.push(this.render(e.footer,t,r)),n.join(`
`).trim()})}};x(Ft,"I18n");Rt.service("i18n",Ft);var dt=class extends Error{constructor(e,t){super(K(e)[0]),this.path=e,this.param=t}};x(dt,"SessionError");var Z;(e=>{e.MAX_DEPTH=64;async function t(r,n){return typeof r=="function"?r(n):r}e.compose=t,x(t,"compose")})(Z||(Z={}));var mt=class{constructor(e,t){this.ctx=e,this.config=t,g(this,at.current,e),this.middleware(this._process.bind(this),!0),e.on("message",this._handleMessage.bind(this)),e.before("attach-user",(n,i)=>{n.collect("user",n.argv,i)}),e.before("attach-channel",(n,i)=>{n.collect("channel",n.argv,i)}),e.component("execute",async(n,i,s)=>s.execute(i.join(""),!0),{session:!0}),e.component("prompt",async(n,i,s)=>(await s.send(i),s.prompt()),{session:!0}),e.component("i18n",async(n,i,s)=>s.text(n.path,i),{session:!0}),e.component("random",async(n,i)=>he.pick(i)),e.component("plural",async(n,i)=>{let s=n.count in i?n.count:i.length-1;return i[s]});let r=["day","hour","minute","second"];e.component("i18n:time",(n,i,s)=>{let o=+n.value;for(let a=0;a<3;a++){let c=Q[r[a]],d=Q[r[a+1]];if(o>=c-d/2){o+=d/2;let b=Math.floor(o/c)+" "+s.text("general."+r[a]);return o%c>d&&(b+=` ${Math.floor(o%c/d)} `+s.text("general."+r[a+1])),b}}return Math.round(o/Q.second)+" "+s.text("general.second")},{session:!0}),e.before("attach",n=>{for(let i of this._matchers)if(this._executeMatcher(n,i),n.response)return})}_hooks=[];_sessions=Object.create(null);_userCache=new ct;_channelCache=new ct;_matchers=new Set;get caller(){return this[at.current]}middleware(e,t=!1){return this.caller.lifecycle.register("middleware",this._hooks,e,t)}match(e,t,r){let n={...r,context:this.caller,pattern:e,response:t};return this._matchers.add(n),this.caller.collect("shortcut",()=>this._matchers.delete(n))}_executeMatcher(e,t){let{parsed:r,quote:n}=e,{appel:i,context:s,i18n:o,regex:a,fuzzy:c,pattern:d,response:b}=t;if((i||r.hasMention)&&!r.appel||!s.filter(e))return;let w=r.content;n&&(w+=" "+n.content);let k=null,m=x(h=>{if(h)if(typeof h=="string"){if(!c&&w!==h||!w.startsWith(h))return;k=[w,w.slice(h.length)],c&&!r.appel&&k[1].match(/^\S/)&&(k=null)}else k=h.exec(w)},"match");if(!o)m(d);else for(let h in this.ctx.i18n._data){let U=this.ctx.i18n._data[h][d];if(U){if(a){let H=c?`(?:${r.appel?"":"\\s+"}([\\s\\S]*))?`:"";U=new RegExp(`^(?:${U})${H}$`)}if(m(U),!!k){e.locale=h;break}}}k&&(e.response=async()=>{let h=await e.resolve(b,k);return et.normalize(h,k.map(_=>_?et.parse(_):""))})}_stripNickname(e,t){t.startsWith("@")&&(t=t.slice(1));for(let r of e.resolve(this.config.nickname)??[]){if(!t.startsWith(r))continue;let n=t.slice(r.length),i=/^([,，]\s*|\s+)/.exec(n);if(i)return n.slice(i[0].length)}}async _process(e,t){let r=!1,n=!1,i=e.content.trim();e.elements??=et.parse(i);let s=!1,o=e.elements.slice();for(;o[0]?.type==="at";){let{attrs:a}=o.shift();a.id===e.selfId&&(r=n=!0),(!e.quote||e.quote.userId!==a.id)&&(s=!0),i=o.join("").trimStart(),o[0]?.type==="text"&&!o[0].attrs.content.trim()&&o.shift()}if(!s){let a=this._stripNickname(e,i);a&&(n=!0,i=a)}if(g(e,"parsed",{hasMention:s,content:i,appel:n,prefix:null}),this.ctx.emit(e,"before-attach",e),this.ctx.database){if(e.subtype==="group"){let d=new Set(["flag","assignee","guildId","locale"]);this.ctx.emit("before-attach-channel",e,d);let b=await e.observeChannel(d);if(b.guildId=e.guildId,await this.ctx.serial(e,"attach-channel",e)||b.flag&st.Flag.ignore||b.assignee!==e.selfId&&!r)return}let a=new Set(["flag","authority","locale"]);this.ctx.emit("before-attach-user",e,a);let c=await e.observeUser(a);if(await this.ctx.serial(e,"attach-user",e)||c.flag&it.Flag.ignore)return}return this.ctx.emit(e,"attach",e),e.response?e.response():t()}async _handleMessage(e){if(e.selfId===e.userId)return;this._sessions[e.id]=e;let t=this._hooks.filter(([i])=>i.filter(e)).map(([,i])=>i.bind(null,e)),r=0,n=x(async i=>{try{if(!this._sessions[e.id])throw new Error("isolated next function detected");if(i!==void 0&&(t.push(s=>Z.compose(i,s)),t.length>Z.MAX_DEPTH))throw new Error(`middleware stack exceeded ${Z.MAX_DEPTH}`);return await t[r++]?.(n)}catch(s){if(s instanceof dt)return e.text(s.path,s.param);let o=ye(s);this.ctx.logger("session").warn(`${e.content}
${o}`)}},"next");try{let i=await n();i&&await e.send(i)}finally{delete this._sessions[e.id],this._userCache.delete(e.id),this._channelCache.delete(e.id),await e.user?.$update(),await e.channel?.$update(),await e.guild?.$update(),this.ctx.emit(e,"middleware",e)}}};x(mt,"Processor");ee(mt,"methods",["middleware","match"]);at.service("$internal",mt);var ct=class{#e=Object.create(null);get(e,t){let r=this.#e[t];if(r)return r.refs.add(e),r.value}set(e,t,r){let n=this.#e[t];n?n.value=r:n=this.#e[t]={value:r,key:t,refs:new Set},n.refs.add(e)}delete(e){for(let t in this.#e){let{refs:r}=this.#e[t];r.delete(e),r.size||delete this.#e[t]}}};x(ct,"SharedCache");be(Rr.prototype,{get app(){return this.root},get options(){return this.root.config},async waterfall(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.lifecycle.getHooks(r,t)){let i=await n.apply(t,e);e[0]=i}return e[0]},chain(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.lifecycle.getHooks(r,t)){let i=n.apply(t,e);e[0]=i}return e[0]},before(e,t,r=!1){let n=e.split("/");return n[n.length-1]="before-"+n[n.length-1],this.on(n.join("/"),t,!r)},createTimerDispose(e){let t=x(()=>{if(clearTimeout(e),!!this.state)return R(this.state.disposables,t)},"dispose");return this.state.disposables.push(t),t},setTimeout(e,t,...r){let n=this.createTimerDispose(setTimeout(()=>{n(),e()},t,...r));return n},setInterval(e,t,...r){return this.createTimerDispose(setInterval(e,t,...r))}});var tt=`"'“‘`,rt=`"'”’`,xe;(e=>{let t={};function r(u,l,f){t[u]={terminator:l,parse:f}}e.interpolate=r,x(r,"interpolate"),r("$(",")");let n;(u=>{u.unescape=x(l=>l.replace(/@__KOISHI_SPACE__@/g," ").replace(/@__KOISHI_NEWLINE__@/g,`
`).replace(/@__KOISHI_RETURN__@/g,"\r").replace(/@__KOISHI_TAB__@/g,"	"),"unescape"),u.escape=x(l=>l.replace(/ /g,"@__KOISHI_SPACE__@").replace(/\n/g,"@__KOISHI_NEWLINE__@").replace(/\r/g,"@__KOISHI_RETURN__@").replace(/\t/g,"@__KOISHI_TAB__@"),"escape")})(n=e.whitespace||(e.whitespace={}));class i{bracs;constructor(){this.bracs=Object.create(t)}interpolate(l,f,p){this.bracs[l]={terminator:f,parse:p}}parseToken(l,f="$"){let p={inters:[]},y=tt.indexOf(l[0]),C=rt[y],v="";C&&(l=l.slice(1),f=`${C}(?=${f})|$`),f+=`|${Object.keys({...this.bracs,...t}).map(Oe).join("|")}`;let S=new RegExp(f);for(;;){let z=S.exec(l);if(v+=n.unescape(l.slice(0,z.index)),z[0]in this.bracs){l=l.slice(z.index+z[0].length).trimStart();let{parse:F,terminator:N}=this.bracs[z[0]],W=F?.(l)||this.parse(l,N);l=W.rest,p.inters.push({...W,pos:v.length,initiator:z[0]})}else{let F=z[0]===C,N=l.slice(z.index+ +F);return p.rest=N.trimStart(),p.quoted=F,p.terminator=z[0],F?p.terminator+=N.slice(0,-p.rest.length):C&&(v=tt[y]+v,p.inters.forEach(W=>W.pos+=1)),p.content=v,C==="'"&&e.revert(p),p}}}parse(l,f=""){let p=[];l=ve.parse(l).map(S=>S.type==="text"?S.toString():n.escape(S.toString())).join("");let y=l,C="",v=`\\s+|[${Oe(f)}]|$`;for(;y&&!(f&&y.startsWith(f));){let S=this.parseToken(y,v);p.push(S),y=S.rest,C=S.terminator,delete S.rest}return y.startsWith(f)&&(y=y.slice(1)),l=l.slice(0,-(y+C).length),y=n.unescape(y),l=n.unescape(l),{tokens:p,rest:y,source:l}}stringify(l){let f=l.tokens.reduce((p,y)=>(y.quoted&&(p+=tt[rt.indexOf(y.terminator[0])]||""),p+y.content+y.terminator),"");return l.rest&&!rt.includes(f[f.length-1])||l.initiator?f.slice(0,-1):f}}x(i,"Tokenizer"),e.Tokenizer=i;let s=new i;function o(u,l=""){return s.parse(u,l)}e.parse=o,x(o,"parse");function a(u){return s.stringify(u)}e.stringify=a,x(a,"stringify");function c(u){for(;u.inters.length;){let{pos:l,source:f,initiator:p}=u.inters.pop();u.content=u.content.slice(0,l)+p+f+t[p].terminator+u.content.slice(l)}}e.revert=c,x(c,"revert");function d(u){return typeof u=="string"?k[u]||{}:{}}x(d,"resolveConfig");let b=Array.isArray;function w(u){return typeof u=="function"?u:u instanceof RegExp?l=>{if(u.test(l))return l;throw new Error}:b(u)?l=>{if(u.includes(l))return l;throw new Error}:k[u]?.transform}x(w,"resolveType");let k={};function m(u,l,f){k[u]={...f,transform:l}}e.createDomain=m,x(m,"createDomain"),m("string",u=>u),m("text",u=>u,{greedy:!0}),m("rawtext",u=>ve.unescape(u),{greedy:!0}),m("boolean",()=>!0),m("number",(u,l)=>{let f=+u;if(Number.isFinite(f))return f;throw new Error("internal.invalid-number")}),m("integer",(u,l)=>{let f=+u;if(f*0===0&&Math.floor(f)===f)return f;throw new Error("internal.invalid-integer")}),m("posint",(u,l)=>{let f=+u;if(f*0===0&&Math.floor(f)===f&&f>0)return f;throw new Error("internal.invalid-posint")}),m("natural",(u,l)=>{let f=+u;if(f*0===0&&Math.floor(f)===f&&f>=0)return f;throw new Error("internal.invalid-natural")}),m("date",(u,l)=>{let f=Q.parseDate(u);if(+f)return f;throw new Error("internal.invalid-date")}),m("user",(u,l)=>{if(u.startsWith("@"))return u=u.slice(1),u.includes(":")?u:`${l.platform}:${u}`;let f=ve.from(u);if(f&&f.type==="at")return`${l.platform}:${f.data.id}`;throw new Error("internal.invalid-user")}),m("channel",(u,l)=>{if(u.startsWith("#"))return u=u.slice(1),u.includes(":")?u:`${l.platform}:${u}`;let f=ve.from(u);if(f&&f.type==="sharp")return`${l.platform}:${f.data.id}`;throw new Error("internal.invalid-channel")});let h=/<[^>]+>|\[[^\]]+\]/g;function _(u){let l,f=[];for(;l=h.exec(u);){let p=l[0].slice(1,-1),y=!1;p.startsWith("...")&&(p=p.slice(3),y=!0);let[C,v]=p.split(":"),S=v?v.trim():void 0;f.push({name:C,variadic:y,type:S,required:l[0][0]==="<"})}return f.stripped=u.replace(/:[\w-]+[>\]]/g,p=>p.slice(-1)).trimEnd(),f}x(_,"parseDecl");function U(u,l,f,p,y={}){let{name:C,type:v}=y,S=w(v);if(S)try{return S(u,p.session)}catch(F){if(!p.session)p.error=`internal.invalid-${f}`;else{let N=p.session.text(F.message||"internal.check-syntax");p.error=p.session.text(`internal.invalid-${f}`,[C,N])}return}if(u===""&&!l)return!0;if(l)return u;let z=+u;return z*0===0?z:u}e.parseValue=U,x(U,"parseValue");class H{constructor(l,f,p){if(this.name=l,this.ctx=p,!l)throw new Error("expect a command name");let y=this._arguments=_(f);this.declaration=y.stripped}declaration;_arguments;_options={};_namedOptions={};_symbolicOptions={};_createOption(l,f,p){let y=/^((?:-[\w-]*|[^,\s\w\x80-\uffff]+)(?:,\s*(?:-[\w-]*|[^,\s\w\x80-\uffff]+))*(?=\s|$))?((?:\s*\[[^\]]+?\]|\s*<[^>]+?>)*)(.*)$/.exec(f),C=ge(l),v=y[1]||"--"+C,S=y[2]||"",z=y[3].trim(),F=[],N=[];for(let V of v.trim().split(",")){V=V.trimStart();let $e=V.replace(/^-+/,"");!$e||!V.startsWith("-")?N.push(ve.escape(V)):F.push($e)}!("value"in p)&&!F.includes(C)&&(v+=", --"+C);let W=_(S.trimStart());W.stripped&&(v+=" "+W.stripped);let A=this._options[l]||={...G.defaultOptionConfig,...W[0],...p,name:l,values:{},valuesSyntax:{},variants:{},syntax:v},q=`commands.${this.name}.options.${l}`,L=typeof A.fallback;"value"in p?(q+="."+p.value,A.variants[p.value]={...p,syntax:v},A.valuesSyntax[p.value]=v,F.forEach(V=>A.values[V]=p.value)):S.trim()?!A.type&&(L==="string"||L==="number")&&(A.type=L):A.type="boolean",z&&this.ctx.i18n.define("",q,z),this._assignOption(A,F,this._namedOptions),this._assignOption(A,N,this._symbolicOptions),this._namedOptions[C]||(this._namedOptions[C]=A)}_assignOption(l,f,p){for(let y of f){if(y in p)throw new Error(`duplicate option name "${y}" for command "${this.name}"`);p[y]=l}}removeOption(l){if(!this._options[l])return!1;let f=this._options[l];delete this._options[l];for(let p in this._namedOptions)this._namedOptions[p]===f&&delete this._namedOptions[p];for(let p in this._symbolicOptions)this._symbolicOptions[p]===f&&delete this._symbolicOptions[p];return!0}parse(l,f,p=[],y={}){for(typeof l=="string"&&(l=e.parse(l,f)),!l.source&&l.tokens&&(l.source=this.name+" "+e.stringify(l));!l.error&&l.tokens?.length;){let C=l.tokens[0],{content:v,quoted:S}=C,z=this._arguments[p.length];if(v[0]!=="-"&&d(z?.type).greedy){p.push(e.parseValue(e.stringify(l),!0,"argument",l,z));break}l.tokens.shift();let F,N,W;if(!S&&(F=this._symbolicOptions[v]))N=[ge(F.name)];else{if(v[0]!=="-"||S){p.push(e.parseValue(v,S,"argument",l,z||{type:"string"}));continue}let A=0,q;for(;A<v.length&&v.charCodeAt(A)===45;++A);if(v.slice(A,A+3)==="no-"&&!this._namedOptions[v.slice(A)]){q=v.slice(A+3),y[me(q)]=!1;continue}let L=A+1;for(;L<v.length&&v.charCodeAt(L)!==61;L++);q=v.slice(A,L),N=A>1?[q]:q,W=v.slice(++L),F=this._namedOptions[N[N.length-1]]}if(S=!1,!W){let{type:A}=F||{};if(d(A).greedy)W=e.stringify(l),S=!0,l.tokens=[];else if(A!=="boolean"&&l.tokens.length&&(A||l.tokens[0]?.content!=="-")){let q=l.tokens.shift();W=q.content,S=q.quoted}}for(let A=0;A<N.length;A++){let q=N[A],L=this._namedOptions[q],V=L?L.name:me(q);if(L&&q in L.values)y[V]=L.values[q];else{let $e=A+1<N.length?"":W;y[V]=e.parseValue($e,S,"option",l,L)}if(l.error)break}}for(let{name:C,fallback:v}of Object.values(this._options))v!==void 0&&!(C in y)&&(y[C]=v);return delete l.tokens,{...l,options:y,args:p,error:l.error||"",command:this}}stringifyArg(l){return l=""+l,l.includes(" ")?`"${l}"`:l}stringify(l,f){let p=this.name;for(let y in f){let C=f[y];C===!0?p+=` --${y}`:C===!1?p+=` --no-${y}`:p+=` --${y} ${this.stringifyArg(C)}`}for(let y of l)p+=" "+this.stringifyArg(y);return p}}x(H,"CommandBase"),e.CommandBase=H})(xe||(xe={}));var nt=new qr("command"),Tt=class extends xe.CommandBase{config;children=[];parent=null;_aliases=[];_examples=[];_usage;_disposed;_disposables;_disposables2=[];_userFields=[["locale"]];_channelFields=[["locale"]];_actions=[];_checkers=[async e=>this.ctx.serial(e.session,"command/before-execute",e)];static userFields(e){return this._userFields.push(e),this}static channelFields(e){return this._channelFields.push(e),this}constructor(e,t,r){super(e,t,r),this.config={...Tt.defaultConfig},this._registerAlias(e),r.$commander._commandList.push(this)}get displayName(){return this._aliases[0]}set displayName(e){this._registerAlias(e,!0)}_registerAlias(e,t=!1){if(e=e.toLowerCase(),e.startsWith(".")&&(e=this.parent.name+e),this._aliases.includes(e)){t&&(R(this._aliases,e),this._aliases.unshift(e));return}else t?this._aliases.unshift(e):this._aliases.push(e);let n=this.ctx.$commander.getCommand(e);if(!n)this.ctx.$commander._commands.set(e,this);else if(n!==this)throw new Error(`duplicate command names: "${e}"`);this._disposables?.push(()=>{R(this._aliases,e),this.ctx.$commander._commands.delete(e)})}[Symbol.for("nodejs.util.inspect.custom")](){return`Command <${this.name}>`}userFields(e){return this._userFields.push(e),this}channelFields(e){return this._channelFields.push(e),this}alias(...e){if(this._disposed)return this;for(let t of e)this._registerAlias(t);return this}_escape(e){return typeof e!="string"?e:e.replace(/\$\$/g,"@@__PLACEHOLDER__@@").replace(/\$\d/g,t=>`{${t[1]}}`).replace(/@@__PLACEHOLDER__@@/g,"$")}shortcut(e,t={}){if(this._disposed)return this;let r=this.displayName;for(let s in t.options||{}){r+=` --${yt(s)}`;let o=t.options[s];o!==!0&&(r+=" "+this._escape(o))}for(let s of t.args||[])r+=" "+this._escape(s);t.fuzzy&&(r+=" {1}");let n=t.i18n;if(typeof e=="string")if(t.i18n)e=`commands.${this.name}.shortcuts.${e}`;else{t.i18n=!0;let s=`commands.${this.name}.shortcuts._${Math.random().toString(36).slice(2)}`;this.ctx.i18n.define("",s,e),e=s}let i=this.ctx.match(e,`<execute>${r}</execute>`,{appel:t.prefix,fuzzy:t.fuzzy,i18n:t.i18n,regex:n});return this._disposables2.push(i),this}subcommand(e,...t){e=this.name+(e.charCodeAt(0)===46?"":"/")+e;let r=typeof t[0]=="string"?t.shift():"",n=t[0]||{};return this._disposed&&(n.patch=!0),this.ctx.command(e,r,n)}usage(e){return this._usage=e,this}example(e){return this._examples.push(e),this}option(e,...t){let r="";typeof t[0]=="string"&&(r=t.shift());let n=t[0];return this._createOption(e,r,n||{}),this._disposables?.push(()=>this.removeOption(e)),this}match(e){let{authority:t=1/0}=e.user||{};return this.ctx.filter(e)&&e.resolve(this.config.authority)<=t}getConfig(e,t){let r=this.config[e];return typeof r=="function"?r(t):r}check(e,t=!1){return this.before(e,t)}before(e,t=!1){return t?this._checkers.push(e):this._checkers.unshift(e),this._disposables?.push(()=>R(this._checkers,e)),this}action(e,t=!1){return t?this._actions.unshift(e):this._actions.push(e),this._disposables?.push(()=>R(this._actions,e)),this}use(e,...t){return e(this,...t)}async execute(e,t=Z.compose){e.command??=this,e.args??=[],e.options??={};let{args:r,options:n,error:i}=e;if(i)return i;nt.level>=3&&nt.debug(e.source||=this.stringify(r,n));for(let c of this._checkers){let d=await c.call(this,e,...r);if(typeof d=="string")return d}if(!this._actions.length)return"";let s=0,o=this._actions.map(c=>async()=>await c.call(this,e,...r));o.push(t);let a=o.length;e.next=async c=>{if(c!==void 0&&(o.push(d=>Z.compose(c,d)),o.length>Z.MAX_DEPTH))throw new Error(`middleware stack exceeded ${Z.MAX_DEPTH}`);return o[s++]?.(e.next)};try{let c=await e.next();if(!I(c))return c}catch(c){if(s===a)throw c;if(c instanceof dt)return e.session.text(c.path,c.param);let d=ye(c);nt.warn(`${e.source||=this.stringify(r,n)}
${d}`),this.ctx.emit(e.session,"command-error",e,c)}return""}dispose(){this._disposed=!0,this._disposables2.forEach(e=>e()),this.ctx.emit("command-removed",this);for(let e of this.children.slice())e.dispose();this._aliases.forEach(e=>this.ctx.$commander._commands.delete(e)),R(this.ctx.$commander._commandList,this),this.parent&&R(this.parent.children,this)}},G=Tt;x(G,"Command");ee(G,"defaultConfig",{authority:1,showWarning:!0});ee(G,"defaultOptionConfig",{authority:0});ee(G,"_userFields",[]);ee(G,"_channelFields",[]);(e=>{e.Config=fe.object({authority:fe.computed(fe.natural()).default(1),hidden:fe.boolean().default(!1),checkArgCount:fe.boolean().default(!1),checkUnknown:fe.boolean().default(!1)})})(G||(G={}));function qt(e){e.on("command-added",t=>{t.userFields(({session:r,tokens:n,command:i,options:s={}},o)=>{if(!i)return;let a=r.resolve(i.config.authority)>0;for(let{name:c,authority:d}of Object.values(i._options))c in s?d>0&&(a=!0):n&&d>0&&(a=!0);a&&o.add("authority")})}),e.before("command/execute",t=>{let{session:r,options:n,command:i}=t;if(!r.user)return;function s(o,...a){return i.config.showWarning?r.text(o,a):""}if(x(s,"sendHint"),typeof r.user.authority=="number"&&r.resolve(i.config.authority)>r.user.authority)return s("internal.low-authority");for(let o of Object.values(i._options))if(o.name in n&&o.authority>r.user.authority)return s("internal.low-authority")},!0),e.before("command/execute",t=>{let{args:r,options:n,command:i,session:s}=t;function o(a,...c){return i.config.showWarning?s.text(a,c):""}if(x(o,"sendHint"),i.config.checkArgCount){if((i._arguments[r.length]||{}).required)return o("internal.insufficient-arguments");let c=i._arguments[i._arguments.length-1]||{};if(r.length>i._arguments.length&&c.type!=="text"&&!c.variadic)return o("internal.redunant-arguments")}if(i.config.checkUnknown){let a=Object.keys(n).filter(c=>!i._options[c]);if(a.length)return o("internal.unknown-option",a.join(", "))}},!0)}x(qt,"validate");var ke=class{constructor(e,t={}){this.ctx=e,this.config=t,g(this,lt.current,e),e.plugin(qt),e.before("parse",(r,n)=>{let i=xe.parse(r);return n.quote&&i.tokens.push({content:n.quote.content,quoted:!0,inters:[],terminator:""}),i}),e.before("attach",r=>{let n=r.parsed.content;for(let i of this._resolvePrefixes(r))if(n.startsWith(i)){r.parsed.prefix=i,n=n.slice(i.length);break}g(r,"argv",e.bail("before-parse",n,r)),r.argv.root=!0,r.argv.session=r}),e.middleware((r,n)=>r.resolveCommand(r.argv)?r.execute(r.argv,n):n()),e.middleware((r,n)=>{let{argv:i,quote:s,subtype:o,parsed:{prefix:a,appel:c}}=r;if(i.command||o!=="private"&&!a&&!c)return n();let d=r.parsed.content.slice((a??"").length),b=d.split(/\s/,1)[0].toLowerCase();return b?n(async w=>{let k=await r.suggest({actual:b,expect:this.available(r),suffix:r.text("internal.suggest-command")});if(!k)return w();let m=k+d.slice(b.length)+(s?" "+s.content:"");return r.execute(m,w)}):n()})}_commandList=[];_commands=new Map;_shortcuts=[];_resolvePrefixes(e){let t=e.resolve(this.config.prefix);return(Array.isArray(t)?t:[t||""]).map(n=>Tr.escape(n))}available(e){return this._commandList.filter(t=>t.match(e)).flatMap(t=>t._aliases)}get caller(){return this[lt.current]}resolve(e){if(!e)return;let t=e.split("."),r=1,n=t[0],i;for(;(i=this.getCommand(n))&&r<t.length;)n=i.name+"."+t[r++];return i}getCommand(e){return this._commands.get(e)}command(e,...t){let r=typeof t[0]=="string"?t.shift():"",n=t[0],i=e.split(" ",1)[0].toLowerCase(),s=e.slice(i.length),o=i.split(/(?=[./])/g),a,c,d=[];if(o.forEach((w,k)=>{let m=w.charCodeAt(0),h=m===46?a.name+w:m===47?w.slice(1):w,_=this.getCommand(h);if(_){if(a){if(_===a)throw new Error(`cannot set a command (${_.name}) as its own subcommand`);if(_.parent){if(_.parent!==a)throw new Error(`cannot create subcommand ${i}: ${_.parent.name}/${_.name} already exists`)}else _.parent=a,a.children.push(_)}return a=_}_=new G(h,k===o.length-1?s:"",this.caller),d.push(_),c||(c=_),a&&(_.parent=a,_.config.authority=a.config.authority,a.children.push(_)),a=_}),r&&this.caller.i18n.define("",`commands.${a.name}.description`,r),Object.assign(a.config,n),d.forEach(w=>this.caller.emit("command-added",w)),!n?.patch)return c&&this.caller.state.disposables.unshift(()=>c.dispose()),a;c&&c.dispose();let b=Object.create(a);return b._disposables=this.caller.state.disposables,b}};x(ke,"Commander");ee(ke,"key","$commander");ee(ke,"methods",["command"]);lt.service(ke.key,ke);var Dt=new Nr("session"),{initialize:Lr}=Nt.prototype;be(Nt.prototype,{[Fr.filter](e){return e.filter(this)},initialize(){Lr.call(this),g(this,"scope",null),g(this,"user",null),g(this,"channel",null),g(this,"guild",null),g(this,"_queuedTasks",[]),g(this,"_queuedTimeout",null)},get username(){let e=this.user&&this.user.name?this.user.name:this.author?this.author.nickname||this.author.username:this.userId;return this.app.chain("appellation",e,this)},async send(e,t={}){if(e)return t.session=this,this.bot.sendMessage(this.channelId,e,this.guildId,t).catch(r=>(Dt.warn(r),[]))},cancelQueued(e=this.app.config.delay.cancel){clearTimeout(this._queuedTimeout),this._queuedTasks=[],this._queuedTimeout=setTimeout(()=>this._next(),e)},_next(){let e=this._queuedTasks.shift();if(!e){this._queuedTimeout=null;return}this.send(e.content).then(e.resolve,e.reject),this._queuedTimeout=setTimeout(()=>this._next(),e.delay)},async sendQueued(e,t){let r=Mt.normalize(e).join("");if(r){if(I(t)){let{message:n,character:i}=this.app.config.delay;t=Math.max(n,i*r.length)}return new Promise((n,i)=>{this._queuedTasks.push({content:e,delay:t,resolve:n,reject:i}),this._queuedTimeout||this._next()})}},resolve(e,...t){return typeof e=="function"?Reflect.apply(e,null,[this,...t]):je(e)?j({_:this},e):e},async getChannel(e=this.channelId,t=[]){let{app:r,platform:n,guildId:i}=this;if(!t.length)return{platform:n,id:e,guildId:i};let s=await r.database.getChannel(n,e,t);if(s)return s;let o=await this.resolve(r.config.autoAssign)?this.selfId:"";if(o)return r.database.createChannel(n,e,{assignee:o,guildId:i});{let a=r.model.tables.channel.create();return Object.assign(a,{platform:n,id:e,guildId:i,$detached:!0}),a}},async _observeChannelLike(e,t=[]){let r=new Set(t),{platform:n}=this,i=`${n}:${e}`,s=this.app.$internal._channelCache.get(this.id,i);if(s){for(let a in s)r.delete(a);if(!r.size)return s}let o=await this.getChannel(e,[...r]);return s=this.app.$internal._channelCache.get(this.id,i),s?s.$merge(o):(s=we(o,a=>this.app.database.setChannel(n,e,a),`channel ${i}`),this.app.$internal._channelCache.set(this.id,i,s)),s},async observeChannel(e=[]){let t=[this._observeChannelLike(this.channelId,e)];this.channelId!==this.guildId&&t.push(this._observeChannelLike(this.guildId,e));let[r,n=r]=await Promise.all(t);return this.guild=n,this.channel=r,r},async getUser(e=this.userId,t=[]){let{app:r,platform:n}=this;if(!t.length)return{[n]:e};let i=await r.database.getUser(n,e,t);if(i)return i;let s=await this.resolve(r.config.autoAuthorize);if(s)return r.database.createUser(n,e,{authority:s});{let o=r.model.tables.user.create();return Object.assign(o,{[n]:e,authority:s,$detached:!0}),o}},async observeUser(e=[]){let t=new Set(e),{userId:r,platform:n}=this,i=this.app.$internal._userCache.get(this.id,this.uid);if(i){for(let o in i)t.delete(o);if(!t.size)return this.user=i}if(this.author?.anonymous){let o=this.app.model.tables.user.create();o[n]=r,o.authority=await this.resolve(this.app.config.autoAuthorize);let a=we(o,()=>Promise.resolve());return this.user=a}let s=await this.getUser(r,[...t]);return i=this.app.$internal._userCache.get(this.id,this.uid),i?i.$merge(s):(i=we(s,o=>this.app.database.setUser(this.platform,r,o),`user ${this.uid}`),this.app.$internal._userCache.set(this.id,this.uid,i)),this.user=i},async withScope(e,t){let r=this.scope;try{return this.scope=e,await t()}finally{this.scope=r}},text(e,t={}){let r=[this.app.config.locale];r.unshift(this.user?.locale),this.subtype==="group"&&(r.unshift(this.guild?.locale),r.unshift(this.channel?.locale)),r.unshift(this.locale);let n=K(e).map(i=>i.startsWith(".")?this.scope?this.scope+i:(this.app.logger("i18n").warn(new Error("missing scope")),""):i);return this.app.i18n.text(r,n,t)},collect(e,t,r=new Set){let n=x(i=>{if(i.session=this,i.tokens)for(let{inters:s}of i.tokens)s.forEach(n);this.resolveCommand(i)&&(this.app.emit(i.session,`command/before-attach-${e}`,i,r),ut(i,G[`_${e}Fields`],r),ut(i,i.command[`_${e}Fields`],r))},"collect");return n(t),r},inferCommand(e){if(e.command)return e.command;if(e.name)return e.command=this.app.$commander.resolve(e.name);let{parsed:t,subtype:r}=this;if(e.root&&r!=="private"&&t.prefix===null&&!t.appel)return;let n=[];for(;e.tokens.length;){let{content:i}=e.tokens[0];n.push(i);let s=this.app.$commander.resolve(n.join("."));if(!s||(e.tokens.shift(),e.command=s,s._actions.length))break}return e.command},resolveCommand(e){if(this.inferCommand(e)){if(e.tokens?.every(t=>!t.inters.length)){let{options:t,args:r,error:n}=e.command.parse(e);e.options={...e.options,...t},e.args=[...e.args||[],...r],e.error=n}return e.command}},async execute(e,t){if(typeof e=="string"&&(e=xe.parse(e)),e.session=this,e.tokens){for(let i of e.tokens){let{inters:s}=i,o=[];for(let a=0;a<s.length;++a)o.push(await this.execute(s[a],!0));for(let a=s.length-1;a>=0;--a){let{pos:c}=s[a];i.content=i.content.slice(0,c)+o[a]+i.content.slice(c)}i.inters=[]}if(!this.resolveCommand(e))return""}else if(e.command||=this.app.$commander.getCommand(e.name),!e.command)return Dt.warn(new Error(`cannot find command ${e.name}`)),"";let{command:r}=e;if(!r.ctx.filter(this))return"";this.app.database&&(this.subtype==="group"&&await this.observeChannel(this.collect("channel",e)),await this.observeUser(this.collect("user",e)));let n=!0;return t===!0&&(n=!1,t=void 0),this.withScope(`commands.${r.name}.messages`,async()=>{let i=await r.execute(e,t);return n?(await this.send(i),""):typeof i=="string"?i:Mt(null,i).toString()})},middleware(e){let t=this.fid;return this.app.middleware(async(r,n)=>t&&r.fid!==t?n():e(r,n),!0)},prompt(...e){let t=typeof e[0]=="function"?e.shift():n=>n.content,r=typeof e[0]=="number"?{timeout:e[0]}:e[0]??{};return new Promise(n=>{let i=this.middleware(async(o,a)=>{clearTimeout(s),i();let c=await t(o);if(n(c),I(c))return a()}),s=setTimeout(()=>{i(),n(void 0)},r.timeout??this.app.config.delay.prompt)})},async suggest(e){let{expect:t,prefix:r=""}=e;if(e.actual&&(t=t.filter(n=>n&&this.app.i18n.compare(n,e.actual,e))),!t.length){await this.send(r);return}if(r+=this.text("internal.suggest-hint",[t.map(n=>this.text("general.quote",[n])).join(this.text("general.or"))]),t.length>1){await this.send(r);return}return await this.send(r+e.suffix),this.prompt(n=>{let i=n.content.trim();if(!i||i==="."||i==="。")return t[0]},e)}});function ut(e,t,r){for(let n of t){if(typeof n=="function"){n(e,r);continue}for(let i of n)r.add(i)}return r}x(ut,"collectFields");export{O as $,se as App,xe as Argv,st as Channel,G as Command,ke as Commander,Ae as Database,Me as DatabaseService,xr as Driver,O as Eval,Le as Field,pt as FilterService,Ft as I18n,Se as Model,Z as Next,mt as Processor,he as Random,Et as RuntimeError,Y as Selection,In as Service,dt as SessionError,ct as SharedCache,Q as Time,it as User,ir as arrayBufferToBase64,pr as assertProperty,sr as base64ToArrayBuffer,me as camelCase,yt as camelize,or as capitalize,pe as clone,ye as coerce,Zt as contain,nr as deduplicate,de as deepEqual,jr as defineConfig,Rn as defineDriver,hr as defineEnumProperty,g as defineProperty,tr as difference,fr as enumKeys,Oe as escapeRegExp,j as executeEval,Ee as executeQuery,_r as executeSort,vr as executeUpdate,be as extend,Hr as hyphenate,yr as interpolate,er as intersection,oe as is,je as isEvalExpr,ur as isInteger,I as isNullable,Gt as isPlainObject,oe as isType,K as makeArray,vt as merge,De as noop,we as observe,Jt as omit,ge as paramCase,Yt as pick,R as remove,dr as renameProperty,ue as resolveConfig,cr as sanitize,Fe as sleep,ar as snakeCase,bt as trimSlash,ze as uncapitalize,rr as union,ae as valueMap,Ut as version};
