import{camelize as b,capitalize as D,Context as N,Schema as O}from"https://registry.koishi.chat/modules/koishi/index.js";function E(e,r,n,s){var o,a=!1,f=0;function p(){o&&clearTimeout(o)}function m(){p(),a=!0}typeof r!="boolean"&&(s=n,n=r,r=void 0);function t(){for(var u=arguments.length,i=new Array(u),c=0;c<u;c++)i[c]=arguments[c];var g=this,v=Date.now()-f;if(a)return;function l(){f=Date.now(),n.apply(g,i)}function w(){o=void 0}s&&!o&&l(),p(),s===void 0&&v>e?l():r!==!0&&(o=setTimeout(s?w:l,s===void 0?e-v:e))}return t.cancel=m,t}function A(e,r,n){return n===void 0?E(e,r,!1):E(e,n,r!==!1)}import{DataService as y}from"https://registry.koishi.chat/modules/@koishijs/plugin-console/index.js";var x=Object.defineProperty,d=(e,r)=>x(e,"name",{value:r,configurable:!0});function S(e){return D(b(e))}d(S,"format");function _(e){return e?!e.name||e.name==="apply"?"Anonymous":S(e.name):"App"}d(_,"getName");function I(e){let{state:r}=e.parent;return r.runtime.isForkable?r.uid:r.runtime.uid}d(I,"getSourceId");var h=class extends y{constructor(e){super(e,"insight"),e.console.addEntry(["https://registry.koishi.chat/modules/@koishijs/plugin-insight/dist/index.js","https://registry.koishi.chat/modules/@koishijs/plugin-insight/dist/style.css"]),e.on("internal/fork",this.update),e.on("internal/runtime",this.update),e.on("internal/service",this.update),e.on("internal/status",this.update)}stop(){this.update.cancel()}update=A(0,()=>{this.refresh()});async get(){let e=[],r=[];for(let n of this.ctx.registry.values()){let s=function(t){return!0},o=function(t){let{uid:u,alias:i,disposables:c,status:g}=t,v=c.length,l={uid:u,name:p,weight:v,status:g};i&&(l.name+=` <${S(i)}>`),e.push(l)},a=function(t,u,i){r.push({type:t,source:u,target:i})},f=function(t){for(let u of n.using){let i=t.ctx[u]?.[N.source]?.state.uid;i&&a("dashed",i,t.uid)}};d(s,"isActive"),d(o,"addNode"),d(a,"addEdge"),d(f,"addDeps");let p=_(n.plugin),m=n.plugin?.reusable;if(!m){if(!s(n))continue;o(n),f(n)}for(let t of n.children)if(n.isForkable){if(!s(t))continue;o(t),a("solid",I(t),t.uid),m?f(t):a("solid",t.uid,n.uid)}else e[e.length-1].weight+=t.disposables.length,a("solid",I(t),n.uid)}return{nodes:e,edges:r}}};d(h,"Insight");(e=>{e.filter=!1,e.using=["console"],e.Config=O.object({})})(h||(h={}));var B=h;export{B as default};
