var y=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var m=(e,t,r,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of I(t))!_.call(e,n)&&n!==r&&y(e,n,{get:()=>t[n],enumerable:!(u=g(t,n))||u.enumerable});return e},f=(e,t,r)=>(m(e,t,"default"),r&&m(r,t,"default"));var v=e=>m(y({},"__esModule",{value:!0}),e);var d={};import*as M from"https://registry.koishi.chat/modules/koishi/index.js";var S=k(()=>{f(d,M)});var F=q(a=>{Object.defineProperty(a,"__esModule",{value:!0});a.apply=a.Config=a.name=void 0;var c=(S(),v(d)),C=c.Schema.object({minTimes:c.Schema.natural().min(2).default(2).required().description("最少重复次数。"),probability:c.Schema.percent().default(1).description("复读发生概率。")});function T(e){if(!e||typeof e!="object")return e;let{minTimes:t=2,probability:r=1}=e;return({repeated:u,times:n,content:s})=>n>=t&&!u&&c.Random.bool(r)?s:""}a.name="repeater";a.Config=c.Schema.object({onRepeat:c.Schema.union([C,Function]).description("响应复读消息。"),onInterrupt:c.Schema.function().hidden().description("响应打断复读。")});function w(e,t={}){e=e.guild();let r={};function u(n){return r[n]||(r[n]={content:"",repeated:!1,times:0,users:{}})}e.before("send",({cid:n,content:s})=>{let i=u(n);i.repeated=!0,i.content===s?i.times+=1:(i.content=s,i.times=1,i.users={})}),e.middleware((n,s)=>{let{content:i,uid:R,userId:p}=n;if(e.bots[R])return;let o=u(n.cid),l=j=>{let h=j?.(o,n);return h&&s(h)};if(i===o.content)return o.times+=1,o.users[p]=(o.users[p]||0)+1,l(T(t.onRepeat))||s();let b=l(t.onInterrupt);return b||(o.content=i,o.repeated=!1,o.times=1,o.users={[p]:1},s())})}a.apply=w});export default F();
